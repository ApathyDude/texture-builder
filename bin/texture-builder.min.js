/*! texture-builder 28-02-2015 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a){function b(a){function b(a){for(var c in a)a[c]instanceof Object&&!(a[c]instanceof Function)?b(a[c]):a[c]instanceof Function&&"handle"===c&&a[c]()}a.preventDefault();for(var c in o)b(o[c].listeners);m=d(m,o)}function c(){var a=g([700,522],"metal"),c=a.children[4],d=function(){var a=document.createElement("div");return a.className="controls",a}(),e=function(){var a=document.createElement("div");a.className="leftdiv";var c=function(){var a=document.createElement("canvas");return a.width=256,a.height=256,a.className="canvas",l=a.getContext("2d"),a}(),e=function(){var a=document.createElement("div");a.className="controls",a.style.width="100%",a.style.display="block",a.style.padding="5px";var c=function(){var a=document.createElement("div"),c=function(){var a=document.createElement("div");return a.innerHTML="Add Layer",a}(),e=function(){function a(a,b){var c=document.createElement("option");return c.innerHTML=a,c.value=b,c}var b=document.createElement("select");for(var c in i)b.appendChild(a(i[c].name,c));return b}(),f=function(){var a=document.createElement("input");return a.type="button",a.value="+",a.style["float"]="right",a.onclick=function(a){var c=i[e.value],f=c.layer(b,h(o,d,b));o.push(f),d.appendChild(f.div),b(a)},a}();return a.appendChild(c),a.appendChild(e),a.appendChild(f),a}();return a.appendChild(c),a}();return a.appendChild(c),a.appendChild(e),a}();return c.appendChild(e),c.appendChild(d),a}function d(a,b){var c=[],d=64;if(a||(a=new f.graphics.Surface([d,d])),a.clear(),!b||0===b.length)return a;for(var e in o)c.push(b[e].render(b[e],b));for(var g in c)a.blit(c[g]);return a}function e(a){l.putImageData(a.scale([256,256]).getImageData(),0,0);var b=f.display.getSurface();b.clear();for(var c=b.getSize()[0],d=b.getSize()[1],e=a.getSize(),g=0;g*e[0]<c;g++)for(var h=0;h*e[1]<d;h++)b.blit(a,[g*e[0],h*e[1]])}var f=a("gamejs"),g=a("./src/menuBuilder"),h=(a("./src/layers/solid"),a("./src/layers/noise"),a("./src/layers/voronoi"),a("./src/layers/shadow"),a("./src/layers/component/control")),i=a("./src/layers");f.preload(a("./src/images"));var j,k,l,m,n=1,o=[];f.ready(function(){var a=document.getElementById("gjs-canvas-wrapper");a.style.display="block";var b=window.innerWidth-2*n,c=window.innerHeight-2*n;f.display.setMode([b,c])}),f.onTick(function(){k||(k=c()),m||(m=d(m,o)),j||(j=document.getElementById("gjs-canvas-wrapper"),j.appendChild(k)),e(m)})},{"./src/images":52,"./src/layers":53,"./src/layers/component/control":54,"./src/layers/noise":58,"./src/layers/shadow":59,"./src/layers/solid":60,"./src/layers/voronoi":61,"./src/menuBuilder":62,gamejs:2}],2:[function(a,b,c){var d=(a("./gamejs/math/matrix"),a("./gamejs/utils/objects")),e=a("./gamejs/utils/callback").Callback,f=c,g={};c.thread=a("./gamejs/thread"),c.ready=f.thread.inWorker===!0?function(b){a("./gamejs/thread")._ready(),f.init(),b()}:function(a){function b(){if(!document.body)return window.setTimeout(b,50);h=f.image.preload(g);try{e=f.audio.preload(g)}catch(a){f.debug("Error loading audio files ",a)}window.setTimeout(c,50)}function c(){return h()<1||e()<1?window.setTimeout(c,100):(f.display.init(),f.image.init(),f.audio.init(),f.event.init(),f.math.random.init(),void a())}function d(){return h?.5*h()+.5*e():.1}var e=null,h=null;return f.time.init(),window.setTimeout(b,13),d},c.init=function(){var a={};return["time","display","image","audio","event"].forEach(function(b){try{f[b].init()}catch(c){a[b]=c.toString()}}),a};{var h=function(){return window.$g&&window.$g.resourceBaseHref||document.location.href};c.preload=function(b){var c=a("./gamejs/utils/uri"),d=h();b.forEach(function(a){g[a]=c.resolve(d,a)},this)}}c.onTick=function(a,b){c.time._CALLBACKS.push(new e(a,b))};var i=c.normalizeRectArguments=function(){var a=0,b=0,c=0,d=0;if(2===arguments.length)arguments[0]instanceof Array&&arguments[1]instanceof Array?(a=arguments[0][0],b=arguments[0][1],c=arguments[1][0],d=arguments[1][1]):(a=arguments[0],b=arguments[1]);else if(1===arguments.length&&arguments[0]instanceof Array)a=arguments[0][0],b=arguments[0][1],c=arguments[0][2],d=arguments[0][3];else if(1===arguments.length&&arguments[0]instanceof j)a=arguments[0].left,b=arguments[0].top,c=arguments[0].width,d=arguments[0].height;else{if(4!==arguments.length)throw new Error("not a valid rectangle specification");a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3]}return{left:a||0,top:b||0,width:c||0,height:d||0}},j=c.Rect=function(){var a=i.apply(this,arguments);return this.left=a.left,this.top=a.top,this.width=a.width,this.height=a.height,this};d.accessors(j.prototype,{bottom:{get:function(){return this.top+this.height},set:function(a){this.top=a-this.height}},right:{get:function(){return this.left+this.width},set:function(a){this.left=a-this.width}},center:{get:function(){return[this.left+this.width/2|0,this.top+this.height/2|0]},set:function(){var a=i.apply(this,arguments);this.left=a.left-this.width/2|0,this.top=a.top-this.height/2|0}},topleft:{get:function(){return[this.left,this.top]},set:function(){var a=i.apply(this,arguments);this.left=a.left,this.top=a.top}},bottomleft:{get:function(){return[this.left,this.bottom]},set:function(){var a=i.apply(this,arguments);this.left=a.left,this.bottom=a.top}},topright:{get:function(){return[this.right,this.top]},set:function(){var a=i.apply(this,arguments);this.right=a.left,this.top=a.top}},bottomright:{get:function(){return[this.right,this.bottom]},set:function(){var a=i.apply(this,arguments);this.right=a.left,this.bottom=a.top}},x:{get:function(){return this.left},set:function(a){this.left=a}},y:{get:function(){return this.top},set:function(a){this.top=a}}}),j.prototype.move=function(){var a=i.apply(this,arguments);return new j(this.left+a.left,this.top+a.top,this.width,this.height)},j.prototype.moveIp=function(){var a=i.apply(this,arguments);this.left+=a.left,this.top+=a.top},j.prototype.clip=function(a){if(!this.collideRect(a))return new j(0,0,0,0);var b,c,d,e;return this.left>=a.left&&this.left<a.right?b=this.left:a.left>=this.left&&a.left<this.right&&(b=a.left),this.right>a.left&&this.right<=a.right?d=this.right-b:a.right>this.left&&a.right<=this.right&&(d=a.right-b),this.top>=a.top&&this.top<a.bottom?c=this.top:a.top>=this.top&&a.top<this.bottom&&(c=a.top),this.bottom>a.top&&this.bottom<=a.bottom?e=this.bottom-c:a.bottom>this.top&&a.bottom<=this.bottom&&(e=a.bottom-c),new j(b,c,d,e)},j.prototype.union=function(a){var b,c,d,e;return b=Math.min(this.left,a.left),c=Math.min(this.top,a.top),d=Math.max(this.right,a.right)-b,e=Math.max(this.bottom,a.bottom)-c,new j(b,c,d,e)},j.prototype.inflate=function(a,b){var c=this.clone();return c.inflateIp(a,b),c},j.prototype.inflateIp=function(a,b){this.left-=Math.floor(a/2),this.top-=Math.floor(b/2),this.width+=a,this.height+=b},j.prototype.collidePoint=function(){var a=i.apply(this,arguments);return this.left<=a.left&&a.left<=this.right&&this.top<=a.top&&a.top<=this.bottom},j.prototype.collideRect=function(a){return!(this.left>a.right||this.right<a.left||this.top>a.bottom||this.bottom<a.top)},j.prototype.collideLine=function(a,b){function c(a){var b=a[0],c=a[1];return(g-e)*b+(d-f)*c+(f*e-d*g)}var d=a[0],e=a[1],f=b[0],g=b[1],h=[[this.left,this.top],[this.left,this.bottom],[this.right,this.top],[this.right,this.bottom]].map(c),i=!0,j=!0,k=!0;return h.forEach(function(a){a>0?j=!1:0>a?i=!1:0===a&&(k=!1)},this),(i||j)&&k?!1:!(d>this.right&&f>this.right||d<this.left&&f<this.left||e<this.top&&g<this.top||e>this.bottom&&g>this.bottom)},j.prototype.toString=function(){return["[",this.left,",",this.top,"]"," [",this.width,",",this.height,"]"].join("")},j.prototype.clone=function(){return new j(this)},c.event=a("./gamejs/event"),c.font=a("./gamejs/font"),c.http=a("./gamejs/http"),c.image=a("./gamejs/image"),c.audio=a("./gamejs/audio"),c.graphics=a("./gamejs/graphics"),c.logging=a("./gamejs/logging"),c.math={matrix:a("./gamejs/math/matrix"),vectors:a("./gamejs/math/vectors"),angles:a("./gamejs/math/angles"),binaryheap:a("./gamejs/math/binaryheap"),random:a("./gamejs/math/random"),noise:a("./gamejs/math/noise")},c.utils={arrays:a("./gamejs/utils/arrays"),objects:a("./gamejs/utils/objects"),uri:a("./gamejs/utils/uri"),strings:a("./gamejs/utils/strings"),xml:a("./gamejs/utils/xml"),base64:a("./gamejs/utils/base64")},c.display=a("./gamejs/display"),c.pathfinding=a("./gamejs/pathfinding"),c.tiledmap=a("./gamejs/tiledmap"),c.time=a("./gamejs/time"),c.pixelcollision=a("./gamejs/pixelcollision")},{"./gamejs/audio":3,"./gamejs/display":4,"./gamejs/event":5,"./gamejs/font":6,"./gamejs/graphics":7,"./gamejs/http":8,"./gamejs/image":9,"./gamejs/logging":10,"./gamejs/math/angles":11,"./gamejs/math/binaryheap":12,"./gamejs/math/matrix":13,"./gamejs/math/noise":14,"./gamejs/math/random":15,"./gamejs/math/vectors":16,"./gamejs/pathfinding":17,"./gamejs/pixelcollision":18,"./gamejs/thread":19,"./gamejs/tiledmap":20,"./gamejs/time":21,"./gamejs/utils/arrays":22,"./gamejs/utils/base64":23,"./gamejs/utils/callback":24,"./gamejs/utils/objects":25,"./gamejs/utils/strings":26,"./gamejs/utils/uri":27,"./gamejs/utils/xml":28}],3:[function(a,b,c){function d(a){a instanceof Array||(a=[a]);document.location.href;a.forEach(function(a){e[a.gamejsKey]=a})}var e=(a("../gamejs"),{}),f=!1,g=8;c.setNumChannels=function(a){g=parseInt(a,10)||g},c.getNumChannels=function(){return g},c.init=function(){var a=Array.prototype.slice.call(document.getElementsByTagName("audio"),0);d(a)},c.preload=function(a){function b(){i++,i==h&&(f=!1)}function c(){return h>0?i/h:1}function e(){d(this),b()}function g(){throw b(),new Error("Error loading "+this.src)}var h=0,i=0;for(var j in a)if(-1!=j.indexOf("wav")||-1!=j.indexOf("ogg")||-1!=j.indexOf("webm")){h++;var k=new Audio;k.addEventListener("canplay",e,!0),k.addEventListener("error",g,!0),k.src=a[j],k.gamejsKey=j,k.load()}return h>0&&(f=!0),c},c.isPreloading=function(){return f},c.Sound=function(a){var b;if(b="string"==typeof a?e[a]:a,!b)throw new Error('Missing "'+a+'", gamejs.preload() all audio files before loading');for(var c=[],d=g;d-->0;){var f=new Audio;f.preload="auto",f.loop=!1,f.src=b.src,c.push(f)}return this.play=function(a){c.some(function(b){return b.ended||b.paused?(b.loop=!!a,b.play(),!0):!1})},this.stop=function(){c.forEach(function(a){a.stop()})},this.setVolume=function(a){c.forEach(function(b){b.volume=a})},this.getVolume=function(){return c[0].volume},this.getLength=function(){return c[0].duration},this}},{"../gamejs":2}],4:[function(a,b,c){function d(){var b=m();h._canvas.width=b.clientWidth,h._canvas.height=b.clientHeight,a("./event")._triggerCallbacks({type:a("./event").DISPLAY_RESIZE})}var e=a("./graphics").Surface,f="gjs-canvas",g="gjs-loader",h=null,i=c.DISABLE_SMOOTHING=2,j=c.FULLSCREEN=4,k=c.POINTERLOCK=8,l=0,m=c._getCanvas=function(){var a=document.getElementById(f);return a||(a=document.createElement("canvas"),a.setAttribute("id",f),document.body.appendChild(a)),a},n=function(){var a=document.getElementById("gjs-fullscreen-toggle");if(!a){a=document.createElement("button"),a.innerHTML="Fullscreen",a.id="gjs-fullscreen-toggle";var b=m();b.parentNode.insertBefore(a,b),b.parentNode.insertBefore(document.createElement("br"),b)}return a},o=function(){var b={type:p()?a("./event").DISPLAY_FULLSCREEN_ENABLED:a("./event").DISPLAY_FULLSCREEN_DISABLED};p()&&l&k&&r(),a("./event")._triggerCallbacks(b)};c.hasPointerLock=function(){return!!(document.pointerLockElement||document.webkitFullscreenElement||document.mozFullscreenElement||document.mozFullScreenElement)},c.init=function(){var a=m();a.getAttribute("tabindex")||(a.setAttribute("tabindex",1),a.focus());var b=document.getElementById(g);b&&(b.style.display="none");var c=document.getElementById(f);c&&(c.style.display="block"),window.addEventListener("resize",d,!1)};var p=c.isFullscreen=function(){return document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen||document.webkitDisplayingFullscreen},q=function(){var a=document.getElementById("gjs-canvas-wrapper");return a.requestFullScreen=a.requestFullScreen||a.mozRequestFullScreen||a.webkitRequestFullScreen,a.requestFullScreen?(Element.ALLOW_KEYBOARD_INPUT?a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.requestFullScreen(),!0):!1},r=function(){var a=m();a.requestPointerLock=a.requestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock,a.requestPointerLock&&a.requestPointerLock()};c._hasFocus=function(){return document.activeElement==m()},c.setMode=function(a,b){h=null;var c=m();if(c.width=c.clientWidth=a[0],c.height=c.clientHeight=a[1],l=l||b,l&k&&(l|=j),l&j){var d=n();d.removeEventListener("click",q,!1),d.addEventListener("click",q,!1),document.removeEventListener("fullScreenchange",o,!1),document.removeEventListener("webkitfullscreenchange",o,!1),document.removeEventListener("mozfullscreenchange",o,!1),document.addEventListener("fullscreenchange",o,!1),document.addEventListener("webkitfullscreenchange",o,!1),document.addEventListener("mozfullscreenchange",o,!1)}return s(a)},c.setCaption=function(a){document.title=a},c._isSmoothingEnabled=function(){return!(l&i)},c._getCanvasOffset=function(){var a=m().getBoundingClientRect();return[a.left,a.top]};var s=c.getSurface=function(a){if(null===h){var b=m();void 0===a&&(a=[b.clientWidth,b.clientHeight]),h=new e(a),h._canvas=b,h._canvas.width=a[0],h._canvas.height=a[1],h._context=b.getContext("2d"),l&i?h._noSmooth():h._smooth()}return h}},{"./event":5,"./graphics":7}],5:[function(a,b,c){var d=a("./display"),e=(a("./utils/callback").Callback,[]),f=c._triggerCallbacks=function(){var a=arguments;e.forEach(function(b){("all"===b.type||a[0].type===b.type)&&b.callback.apply(b.scope,a)})};c.onFullscreen=function(a,b){if("function"!=typeof a)throw new Error("Callback must be a function");e.push({callback:a,scope:b,type:c.DISPLAY_FULLSCREEN_ENABLED}),e.push({callback:a,scope:b,type:c.DISPLAY_FULLSCREEN_DISABLED})},c.onEvent=function(a,b){if("function"!=typeof a)throw new Error("Callback must be a function");e.push({callback:a,scope:b,type:"all"})},c.onDisplayResize=function(a,b){if("function"!=typeof a)throw new Error("Callback must be a function");e.push({callback:a,scope:b,type:c.DISPLAY_RESIZE})},c.onMouseMotion=function(a,b){if("function"!=typeof a)throw new Error("Callback must be a function");e.push({callback:a,scope:b,type:c.MOUSE_MOTION})},c.onMouseUp=function(a,b){if("function"!=typeof a)throw new Error("Callback must be a function");e.push({callback:a,scope:b,type:c.MOUSE_UP})},c.onMouseDown=function(a,b){if("function"!=typeof a)throw new Error("Callback must be a function");e.push({callback:a,scope:b,type:c.MOUSE_DOWN})},c.onTouchMotion=function(a,b){if("function"!=typeof a)throw new Error("Callback must be a function");e.push({callback:a,scope:b,type:c.TOUCH_MOTION})},c.onTouchUp=function(a,b){if("function"!=typeof a)throw new Error("Callback must be a function");e.push({callback:a,scope:b,type:c.TOUCH_UP})},c.onTouchDown=function(a,b){if("function"!=typeof a)throw new Error("Callback must be a function");e.push({callback:a,scope:b,type:c.TOUCH_DOWN})},c.onKeyDown=function(a,b){if("function"!=typeof a)throw new Error("Callback must be a function");e.push({callback:a,scope:b,type:c.KEY_DOWN})},c.onKeyUp=function(a,b){if("function"!=typeof a)throw new Error("Callback must be a function");e.push({callback:a,scope:b,type:c.KEY_UP})},c.K_UP=38,c.K_DOWN=40,c.K_RIGHT=39,c.K_LEFT=37,c.K_SPACE=32,c.K_BACKSPACE=8,c.K_TAB=9,c.K_ENTER=13,c.K_SHIFT=16,c.K_CTRL=17,c.K_ALT=18,c.K_ESC=27,c.K_0=48,c.K_1=49,c.K_2=50,c.K_3=51,c.K_4=52,c.K_5=53,c.K_6=54,c.K_7=55,c.K_8=56,c.K_9=57,c.K_a=65,c.K_b=66,c.K_c=67,c.K_d=68,c.K_e=69,c.K_f=70,c.K_g=71,c.K_h=72,c.K_i=73,c.K_j=74,c.K_k=75,c.K_l=76,c.K_m=77,c.K_n=78,c.K_o=79,c.K_p=80,c.K_q=81,c.K_r=82,c.K_s=83,c.K_t=84,c.K_u=85,c.K_v=86,c.K_w=87,c.K_x=88,c.K_y=89,c.K_z=90,c.K_KP1=97,c.K_KP2=98,c.K_KP3=99,c.K_KP4=100,c.K_KP5=101,c.K_KP6=102,c.K_KP7=103,c.K_KP8=104,c.K_KP9=105,c.NOEVENT=0,c.NUMEVENTS=32e3,c.DISPLAY_FULLSCREEN_ENABLED=300,c.DISPLAY_FULLSCREEN_DISABLED=301,c.DISPLAY_RESIZE=302,c.QUIT=0,c.KEY_DOWN=1,c.KEY_UP=2,c.MOUSE_MOTION=3,c.MOUSE_UP=4,c.MOUSE_DOWN=5,c.MOUSE_WHEEL=6,c.TOUCH_UP=7,c.TOUCH_DOWN=8,c.TOUCH_MOTION=9,c.USEREVENT=2e3,c.Event=function(){this.type=null,this.key=null,this.rel=null,this.button=null,this.pos=null},c.init=function(){function a(a){var b=d._getCanvasOffset();f({type:c.MOUSE_DOWN,pos:[a.clientX-b[0],a.clientY-b[1]],button:a.button,shiftKey:a.shiftKey,ctrlKey:a.ctrlKey,metaKey:a.metaKey})}function b(a){var b=d._getCanvasOffset();f({type:c.MOUSE_UP,pos:[a.clientX-b[0],a.clientY-b[1]],button:a.button,shiftKey:a.shiftKey,ctrlKey:a.ctrlKey,metaKey:a.metaKey})}function e(a){var b=a.keyCode||a.which;f({type:c.KEY_DOWN,key:b,shiftKey:a.shiftKey,ctrlKey:a.ctrlKey,metaKey:a.metaKey}),(d._hasFocus()&&!a.ctrlKey&&!a.metaKey&&(b>=c.K_LEFT&&b<=c.K_DOWN||b>=c.K_0&&b<=c.K_z||b>=c.K_KP1&&b<=c.K_KP9||b===c.K_SPACE||b===c.K_TAB||b===c.K_ENTER)||b===c.K_ALT)&&a.preventDefault()}function g(a){f({type:c.KEY_UP,key:a.keyCode,shiftKey:a.shiftKey,ctrlKey:a.ctrlKey,metaKey:a.metaKey})}function h(a){var b=d._getCanvasOffset(),e=[a.clientX-b[0],a.clientY-b[1]],g=[];o.length&&(g=[o[0]-e[0],o[1]-e[1]]),f({type:c.MOUSE_MOTION,pos:e,rel:g,buttons:null,timestamp:a.timeStamp,movement:[a.movementX||a.mozMovementX||a.webkitMovementX||0,a.movementY||a.mozMovementY||a.webkitMovementY||0]}),o=e}function i(a){var b=d._getCanvasOffset(),e=[a.clientX-b[0],a.clientY-b[1]];f({type:c.MOUSE_WHEEL,pos:e,delta:a.detail||-a.wheelDeltaY/40})}function j(){f({type:c.QUIT})}function k(a){for(var b=d._getCanvasOffset(),c=[],e=0;e<a.length;e++){var f=a.item(e);c.push({identifier:f.identifier,pos:[f.clientX-b[0],f.clientY-b[1]]})}return c}function l(a){var b=(d._getCanvasOffset(),k(a.changedTouches));f({type:c.TOUCH_DOWN,touches:b})}function m(a){var b=k(a.changedTouches);f({type:c.TOUCH_UP,touches:b})}function n(a){var b=k(a.changedTouches);f({type:c.TOUCH_MOTION,touches:b}),a.preventDefault()}var o=[],p=d._getCanvas();document.addEventListener("mousedown",a,!1),document.addEventListener("mouseup",b,!1),document.addEventListener("keydown",e,!1),document.addEventListener("keyup",g,!1),document.addEventListener("mousemove",h,!1),p.addEventListener("mousewheel",i,!1),p.addEventListener("DOMMouseScroll",i,!1),p.addEventListener("beforeunload",j,!1),p.addEventListener("touchstart",l,!1),p.addEventListener("touchend",m,!1),p.addEventListener("touchcancel",m,!1),p.addEventListener("touchleave",m,!1),p.addEventListener("touchmove",n,!1)}},{"./display":4,"./utils/callback":24}],6:[function(a,b,c){var d=a("./graphics").Surface,e=a("./utils/objects"),f=c.Font=function(a,b){return this.sampleSurface=new d([10,10]),this.sampleSurface.context.font=a,this.sampleSurface.context.textAlign="start",this.sampleSurface.context.textBaseline="bottom",this.backgroundColor=b||!1,this};f.prototype.render=function(a,b){var c=this.size(a),e=new d(c),f=e.context;return f.save(),this.backgroundColor&&(f.fillStyle=this.backgroundColor,f.fillRect(0,0,e.rect.width,e.rect.height)),f.font=this.sampleSurface.context.font,f.textBaseline=this.sampleSurface.context.textBaseline,f.textAlign=this.sampleSurface.context.textAlign,f.fillStyle=f.strokeStyle=b||"#000000",f.fillText(a,0,e.rect.height,e.rect.width),f.restore(),e},f.prototype.size=function(a){var b=this.sampleSurface.context.measureText(a);return[b.width,this.fontHeight]},e.accessors(f.prototype,{fontHeight:{get:function(){return 1.5*this.sampleSurface.context.measureText("M").width}}})},{"./graphics":7,"./utils/objects":25}],7:[function(a,b,c){var d=a("../gamejs"),e=d.Rect,f=a("./utils/objects"),g=a("./math/matrix"),h=a("./math/vectors"),i=c.Surface=function(){var a=d.normalizeRectArguments.apply(this,arguments),b=a.left,c=a.top;return 1==arguments.length&&arguments[0]instanceof e&&(b=a.width,c=a.height),this._matrix=g.identity(),this._canvas=document.createElement("canvas"),this._canvas.width=b,this._canvas.height=c,this._blitAlpha=1,this._context=this._canvas.getContext("2d"),d.display._isSmoothingEnabled()?this._smooth():this._noSmooth(),this};i.prototype._noSmooth=function(){this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1},i.prototype._smooth=function(){this.context.mozImageSmoothingEnabled=!0,this.context.webkitImageSmoothingEnabled=!0},i.prototype.blit=function(a,b,c,d){var f,g;if(b instanceof e){f=b.clone();var h=a.getSize();f.width||(f.width=h[0]),f.height||(f.height=h[1])}else f=b&&b instanceof Array&&2==b.length?new e(b,a.getSize()):new e([0,0],a.getSize());if(d=d||"source-over",c instanceof e)g=c;else if(c&&c instanceof Array&&2==c.length){var i=a.getSize();g=new e(c,[i[0]-c[0],i[1]-c[1]])}else g=new e([0,0],a.getSize());if(isNaN(f.left)||isNaN(f.top)||isNaN(f.width)||isNaN(f.height))throw new Error("[blit] bad parameters, destination is "+f);this.context.save(),this.context.globalCompositeOperation=d,this.context.globalAlpha=a._blitAlpha,this.context.drawImage(a.canvas,g.left,g.top,g.width,g.height,f.left,f.top,f.width,f.height),this.context.restore()},i.prototype.getSize=function(){return[this.canvas.width,this.canvas.height]},i.prototype.getRect=function(){return new e([0,0],this.getSize())},i.prototype.fill=function(a,b){this.context.save(),this.context.fillStyle=a||"#000000",void 0===b&&(b=new e(0,0,this.canvas.width,this.canvas.height)),this.context.fillRect(b.left,b.top,b.width,b.height),this.context.restore()},i.prototype.clear=function(a){var b=this.getSize();a=a||new e(0,0,b[0],b[1]),this.context.clearRect(a.left,a.top,a.width,a.height)},f.accessors(i.prototype,{rect:{get:function(){return this.getRect()}},context:{get:function(){return this._context}},canvas:{get:function(){return this._canvas}}}),i.prototype.clone=function(){var a=new i(this.getRect());return a.blit(this),a},i.prototype.getAlpha=function(){return 1-this._blitAlpha},i.prototype.setAlpha=function(a){return isNaN(a)||0>a||a>1?void 0:(this._blitAlpha=1-a,1-this._blitAlpha)},i.prototype.getImageData=function(){var a=this.getSize();return this.context.getImageData(0,0,a[0],a[1])},c.line=function(a,b,c,d,e){var f=a.context;f.save(),f.beginPath(),f.strokeStyle=b,f.lineWidth=e||1,f.moveTo(c[0],c[1]),f.lineTo(d[0],d[1]),f.stroke(),f.restore()},c.lines=function(a,b,c,d,e){c=c||!1;var f=a.context;f.save(),f.beginPath(),f.strokeStyle=f.fillStyle=b,f.lineWidth=e||1,d.forEach(function(a,b){0===b?f.moveTo(a[0],a[1]):f.lineTo(a[0],a[1])}),c&&f.lineTo(d[0][0],d[0][1]),f.stroke(),f.restore()},c.circle=function(a,b,c,d,e){if(isNaN(d))throw new Error("[circle] radius required argument");if(!(c&&c instanceof Array))throw new Error("[circle] pos must be given & array"+c);var f=a.context;f.save(),f.beginPath(),f.strokeStyle=f.fillStyle=b,f.lineWidth=e||1,f.arc(c[0],c[1],d,0,2*Math.PI,!0),void 0===e||0===e?f.fill():f.stroke(),f.restore()},c.rect=function(a,b,c,d){var e=a.context;e.save(),e.beginPath(),e.strokeStyle=e.fillStyle=b,isNaN(d)||0===d?e.fillRect(c.left,c.top,c.width,c.height):(e.lineWidth=d||1,e.strokeRect(c.left,c.top,c.width,c.height)),e.restore()},c.arc=function(a,b,c,d,e,f,g){var h=a.context;h.save(),h.beginPath(),h.strokeStyle=h.fillStyle=b,h.arc(c[0],c[1],f,d,e,!1),isNaN(g)||0===g?h.fill():(h.lineWidth=g||1,h.stroke()),h.restore()},c.polygon=function(a,b,c,d){var e=a.context;e.save(),e.fillStyle=e.strokeStyle=b,e.beginPath(),c.forEach(function(a,b){0===b?e.moveTo(a[0],a[1]):e.lineTo(a[0],a[1])}),e.closePath(),isNaN(d)||0===d?e.fill():(e.lineWidth=d||1,e.stroke()),e.restore()},c.quadraticCurve=function(a,b,c,d,e,f){if(!(c&&c instanceof Array))throw new Error("[quadratic_curve] startPos must be defined!");if(!(d&&d instanceof Array))throw new Error("[quadratic_curve] endPos must be defined!");if(!(e&&e instanceof Array))throw new Error("[quadratic_curve] controlPos must be defined!");var g=a.context;g.save(),g.fillStyle=g.strokeStyle=b,g.lineWidth=f||1,g.beginPath(),g.moveTo(c[0],c[1]),g.quadraticCurveTo(e[0],e[1],d[0],d[1]),g.stroke(),g.restore()},c.bezierCurve=function(a,b,c,d,e,f,g){if(!(c&&c instanceof Array))throw new Error("[bezier_curve] startPos must be defined!");if(!(d&&d instanceof Array))throw new Error("[bezier_curve] endPos must be defined!");if(!(e&&e instanceof Array))throw new Error("[bezier_curve] ct1Pos must be defined!");if(!(f&&f instanceof Array))throw new Error("[bezier_curve] ct2Pos must be defined!");var h=a.context;h.save(),h.fillStyle=h.strokeStyle=b,h.lineWidth=g||1,h.beginPath(),h.moveTo(c[0],c[1]),h.bezierCurveTo(e[0],e[1],f[0],f[1],d[0],d[1]),h.stroke(),h.restore()},i.prototype.rotate=function(a){var b=this.getSize(),c=a*Math.PI/180,d=b;if(a%360!==0){var e=this.getRect(),f=[[-e.width/2,e.height/2],[e.width/2,e.height/2],[-e.width/2,-e.height/2],[e.width/2,-e.height/2]],j=f.map(function(a){return h.rotate(a,c)}),k=j.map(function(a){return a[0]}),l=j.map(function(a){return a[1]}),m=Math.min.apply(Math,k),n=Math.max.apply(Math,k),o=Math.min.apply(Math,l),p=Math.max.apply(Math,l);d=[n-m,p-o]}var q=new i(d),r=g.translate(this._matrix,b[0]/2,b[1]/2);r=g.rotate(r,c),r=g.translate(r,-b[0]/2,-b[1]/2);var s=[(d[0]-b[0])/2,(d[1]-b[1])/2];return q.context.save(),q.context.transform(r[0],r[1],r[2],r[3],r[4],r[5]),q.blit(this,s),q.context.restore(),q},i.prototype.scale=function(a){var b=a[0],c=a[1];if(0>=b||0>=c)throw new Error("[gamejs.transform.scale] Invalid arguments for height and width",[b,c]);var d=this.getSize(),e=b/d[0],f=c/d[1],h=new i([b,c]),j=(this._matrix.slice(0),g.scale(g.identity(),[e,f]));return h.context.save(),h.context.transform(j[0],j[1],j[2],j[3],j[4],j[5]),h.blit(this),h.context.restore(),h},i.prototype.flip=function(a,b){var c=this.getSize(),d=new i(c),e=1,f=1,g=0,h=0;return a===!0&&(e=-1,g=-c[0]),b===!0&&(f=-1,h=-c[1]),d.context.save(),d.context.scale(e,f),d.context.drawImage(this.canvas,g,h),d.context.restore(),d},c.blitArray=function(a,b){a.context.putImageData(b.imageData,0,0)};c.SurfaceArray=function(a){var b=null,c=null,e=null;return this.set=function(a,d,e){var f=4*a+d*b[0]*4;c[f]=e[0],c[f+1]=e[1],c[f+2]=e[2],c[f+3]=void 0===e[3]?255:e[3]},this.get=function(a,d){var e=4*a+d*b[0]*4;return[c[e],c[e+1],c[e+2],c[e+3]]},this.surface=null,f.accessors(this,{surface:{get:function(){var a=new d.graphics.Surface(b);return a.context.putImageData(e,0,0),a}},imageData:{get:function(){return e}}}),this.getSize=function(){return b},a instanceof Array?(b=a,e=d.display.getSurface().context.createImageData(b[0],b[1]),c=e.data):(b=a.getSize(),e=a.getImageData(0,0,b[0],b[1]),c=e.data),this}},{"../gamejs":2,"./math/matrix":13,"./math/vectors":16,"./utils/objects":25}],8:[function(require,module,exports){function stringify(response){return eval("("+response.responseText+")")}function ajaxBaseHref(){return window.$g&&window.$g.ajaxBaseHref||"./"}exports.Response=function(){throw this.getResponseHeader=function(){},new Error("response class not instantiable")};var ajax=exports.ajax=function(a,b,c,d){c=c||null;var e=new XMLHttpRequest;return e.open(a,b,!1),d&&e.setRequestHeader("Accept",d),c instanceof Object&&(c=JSON.stringify(c),e.setRequestHeader("Content-Type","application/json")),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.send(c),e},get=exports.get=function(a){return ajax("GET",a)},post=exports.post=function(a,b,c){return ajax("POST",a,b,c)};exports.load=function(a){return stringify(get(ajaxBaseHref()+a))},exports.save=function(a,b,c){return stringify(post(ajaxBaseHref()+a,{payload:b},c))}},{}],9:[function(a,b,c){var d=a("../gamejs"),e={},f=!1;c.load=function(a){var b;if("string"==typeof a){if(b=e[a],!b)throw new Error('Missing "'+a+'", gamejs.preload() all images before trying to load them.')}else b=a;var c=document.createElement("canvas");c.width=b.naturalWidth||b.width,c.height=b.naturalHeight||b.height;var f=c.getContext("2d");f.drawImage(b,0,0),b.getSize=function(){return[b.naturalWidth,b.naturalHeight]};var g=new d.graphics.Surface(b.getSize());return g._canvas=c,g._context=f,g},c.init=function(){},c.preload=function(a){function b(){j++,j==k&&(f=!1),j%10===0&&d.logging.debug("gamejs.image: preloaded  "+j+" of "+k)}function c(){return k>0?j/k:1}function e(){g(this),b()}function h(){throw b(),new Error("Error loading "+this.src)}var i,j=0,k=0;for(i in a){var l=i.toLowerCase();if(-1!=l.indexOf(".png")||-1!=l.indexOf(".jpg")||-1!=l.indexOf(".jpeg")||-1!=l.indexOf(".svg")||-1!=l.indexOf(".gif")){var m=new Image;m.addEventListener("load",e,!0),m.addEventListener("error",h,!0),m.src=a[i],m.gamejsKey=i,k++}}return k>0&&(f=!0),c};var g=function(a){e[a.gamejsKey]=a}},{"../gamejs":2}],10:[function(a,b,c){var d=["debug","info","warn","error","fatal"],e=2,f=a("../gamejs");c.setLogLevel=function(a){if("string"==typeof a&&d.indexOf(a))e=d.indexOf(a);else{if("number"!=typeof a)throw new Error("invalid logLevel ",a," Must be one of: ",d);e=a}return e};var g=c.log=function(){if(f.thread.inWorker===!0)return void f.thread._logMessage.apply(null,arguments);var a=Array.prototype.slice.apply(arguments,[0]);a.unshift(Date.now()),void 0!==window.console&&console.log.apply&&console.log.apply(console,a)};c.debug=function(){e<=d.indexOf("debug")&&g.apply(this,arguments)},c.info=function(){e<=d.indexOf("info")&&g.apply(this,arguments)},c.warn=function(){e<=d.indexOf("warn")&&g.apply(this,arguments)},c.error=function(){e<=d.indexOf("error")&&g.apply(this,arguments)},c.fatal=function(){e<=d.indexOf("fatal")&&g.apply(this,arguments)}},{"../gamejs":2}],11:[function(a,b,c){c.normaliseDegrees=function(a){return a%=360,0>a&&(a+=360),a},c.normaliseRadians=function(a){return a%=2*Math.PI,0>a&&(a+=2*Math.PI),a},c.degrees=function(a){return a*(180/Math.PI)},c.radians=function(a){return a*(Math.PI/180)}},{}],12:[function(a,b,c){var d=c.BinaryHeap=function(a){return this.content=[],this.scoreFunction=a,this};d.prototype.push=function(a){this.content.push(a),this.sinkDown(this.content.length-1)},d.prototype.pop=function(){var a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a},d.prototype.remove=function(a){var b=this.content.some(function(b,c){if(b==a){var d=this.content.pop();return c!=this.content.length&&(this.content[c]=d,this.scoreFunction(d)<this.scoreFunction(a)?this.sinkDown(c):this.bubbleUp(c)),!0}return!1},this);return b},d.prototype.size=function(){return this.content.length},d.prototype.sinkDown=function(a){for(var b=this.content[a];a>0;){var c=Math.floor((a+1)/2)-1,d=this.content[c];if(!(this.scoreFunction(b)<this.scoreFunction(d)))break;this.content[c]=b,this.content[a]=d,a=c}},d.prototype.bubbleUp=function(a){for(var b=this.content.length,c=this.content[a],d=this.scoreFunction(c);;){var e,f=2*(a+1),g=f-1,h=null;if(b>g){var i=this.content[g];e=this.scoreFunction(i),d>e&&(h=g)}if(b>f){var j=this.content[f],k=this.scoreFunction(j);(null===h?d:e)>k&&(h=f)}if(null===h)break;this.content[a]=this.content[h],this.content[h]=c,a=h}}},{}],13:[function(a,b,c){{var d=(c.identity=function(){return[1,0,0,1,0,0]},c.add=function(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2],a[3]+b[3],a[4]+b[4],a[5]+b[5],a[6]+b[6]]},c.multiply=function(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*b[5]+a[5]]});c.translate=function(a,b,c){return d(a,[1,0,0,1,b,c])},c.rotate=function(a,b){var c=Math.sin(b),e=Math.cos(b);return d(a,[e,c,-c,e,0,0])},c.rotation=function(a){return Math.atan2(a[1],a[0])},c.scale=function(a,b){var c=b[0],e=b[1];return d(a,[c,0,0,e,0,0])}}},{}],14:[function(a,b,c){var d=c.Simplex=function(a){void 0===a&&(a=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[];
var b;for(b=0;256>b;b++)this.p[b]=Math.floor(256*a.random());for(this.perm=[],b=0;512>b;b++)this.perm[b]=this.p[255&b];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};d.prototype.dot=function(a,b,c){return a[0]*b+a[1]*c},d.prototype.get=function(a,b){var c,d,e,f,g,h=.5*(Math.sqrt(3)-1),i=(a+b)*h,j=Math.floor(a+i),k=Math.floor(b+i),l=(3-Math.sqrt(3))/6,m=(j+k)*l,n=j-m,o=k-m,p=a-n,q=b-o;p>q?(f=1,g=0):(f=0,g=1);var r=p-f+l,s=q-g+l,t=p-1+2*l,u=q-1+2*l,v=255&j,w=255&k,x=this.perm[v+this.perm[w]]%12,y=this.perm[v+f+this.perm[w+g]]%12,z=this.perm[v+1+this.perm[w+1]]%12,A=.5-p*p-q*q;0>A?c=0:(A*=A,c=A*A*this.dot(this.grad3[x],p,q));var B=.5-r*r-s*s;0>B?d=0:(B*=B,d=B*B*this.dot(this.grad3[y],r,s));var C=.5-t*t-u*u;return 0>C?e=0:(C*=C,e=C*C*this.dot(this.grad3[z],t,u)),70*(c+d+e)},d.prototype.get3d=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n=1/3,o=(a+b+c)*n,p=Math.floor(a+o),q=Math.floor(b+o),r=Math.floor(c+o),s=1/6,t=(p+q+r)*s,u=p-t,v=q-t,w=r-t,x=a-u,y=b-v,z=c-w;x>=y?y>=z?(h=1,i=0,j=0,k=1,l=1,m=0):x>=z?(h=1,i=0,j=0,k=1,l=0,m=1):(h=0,i=0,j=1,k=1,l=0,m=1):z>y?(h=0,i=0,j=1,k=0,l=1,m=1):z>x?(h=0,i=1,j=0,k=0,l=1,m=1):(h=0,i=1,j=0,k=1,l=1,m=0);var A=x-h+s,B=y-i+s,C=z-j+s,D=x-k+2*s,E=y-l+2*s,F=z-m+2*s,G=x-1+3*s,H=y-1+3*s,I=z-1+3*s,J=255&p,K=255&q,L=255&r,M=this.perm[J+this.perm[K+this.perm[L]]]%12,N=this.perm[J+h+this.perm[K+i+this.perm[L+j]]]%12,O=this.perm[J+k+this.perm[K+l+this.perm[L+m]]]%12,P=this.perm[J+1+this.perm[K+1+this.perm[L+1]]]%12,Q=.6-x*x-y*y-z*z;0>Q?d=0:(Q*=Q,d=Q*Q*this.dot(this.grad3[M],x,y,z));var R=.6-A*A-B*B-C*C;0>R?e=0:(R*=R,e=R*R*this.dot(this.grad3[N],A,B,C));var S=.6-D*D-E*E-F*F;0>S?f=0:(S*=S,f=S*S*this.dot(this.grad3[O],D,E,F));var T=.6-G*G-H*H-I*I;return 0>T?g=0:(T*=T,g=T*T*this.dot(this.grad3[P],G,H,I)),32*(d+e+f+g)}},{}],15:[function(a,b,c){{var d=function(){var a=4022871197;return this.hash=function(b){b=b.toString();var c;for(c=0;c<b.length;c++){a+=b.charCodeAt(c);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=4294967296*d}return 2.3283064365386963e-10*(a>>>0)},this.version="Mash 0.9",this},e=c.Alea=function(){var a=Array.prototype.slice.call(arguments),b=0,c=0,e=0,f=1;0!==a.length&&a[0]||(a=[Date.now()]);var g=new d;b=g.hash(" "),c=g.hash(" "),e=g.hash(" ");var h;for(h=0;h<a.length;h++)b-=g.hash(a[h]),0>b&&(b+=1),c-=g.hash(a[h]),0>c&&(c+=1),e-=g.hash(a[h]),0>e&&(e+=1);return g=null,this.random=function(){var a=2091639*b+2.3283064365386963e-10*f;return b=c,c=e,e=a-(f=0|a)},this.integer=function(a,b){return a+parseInt(this.random()*(b-a+1),10)},this.vector=function(a,b){return[this.integer(a[0],b[0]),this.integer(a[1],b[1])]},this.choose=function(a){return a[this.integer(0,a.length-1)]},this},f=null;c.integer=function(a,b){return f.integer(a,b)}}c.vector=function(a,b){return f.vector(a,b)},c.choose=function(a){return f.choose(a)},c.random=function(){return f.random()},c.init=function(a){f=new e(a)}},{}],16:[function(a,b,c){var d=a("./angles");c.distance=function(a,b){return g(e(a,b))};var e=c.subtract=function(a,b){return[a[0]-b[0],a[1]-b[1]]},f=(c.add=function(a,b){return[a[0]+b[0],a[1]+b[1]]},c.multiply=function(a,b){return"number"==typeof b?[a[0]*b,a[1]*b]:[a[0]*b[0],a[1]*b[1]]});c.divide=function(a,b){if("number"==typeof b)return[a[0]/b,a[1]/b];throw new Error("only divide by scalar supported")};var g=c.len=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])},h=c.unit=function(a){var b=g(a);return b?[a[0]/b,a[1]/b]:[0,0]};c.rotate=function(a,b){return b=d.normaliseRadians(b),[a[0]*Math.cos(b)-a[1]*Math.sin(b),a[0]*Math.sin(b)+a[1]*Math.cos(b)]};var i=c.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};c.angle=function(a,b){var c=a[0]*b[1]-a[1]*b[0];return Math.atan2(c,i(a,b))},c.truncate=function(a,b){return g(a)>b?f(h(a),b):a},c.centroid=function(){var a=Array.prototype.slice.apply(arguments,[0]),b=[0,0];a.forEach(function(a){b[0]+=parseInt(a[0],10),b[1]+=parseInt(a[1],10)});var c=a.length;return[b[0]/c,b[1]/c]}},{"./angles":11}],17:[function(a,b,c){function d(a){var b={};return this.store=function(c,d){b[a(c)]=d},this.find=function(c){return b[a(c)]},this}var e=a("./math/binaryheap").BinaryHeap;c.findRoute=function(a,b,c,h){function i(b){return void 0===b.score&&(b.score=a.estimatedDistance(b.point,c)+b.length),b.score}function j(a){l.push(a),n.store(a.point,a)}function k(b){var c=n.find(b),d=p.length+a.actualDistance(p.point,b);(!c||c.length>d)&&(c&&l.remove(c),j({point:b,from:p,length:d}))}var l=new e(i),m="function"==typeof a.hash?a.hash:g,n=new d(m),o=Date.now(),p=null;j({point:b,from:null,length:0});for(var q="function"==typeof a.equals?a.equals:f;l.size()>0&&(!h||Date.now()-o<h);){if(p=l.pop(),q(c,p.point))return p;a.adjacent(p.point).forEach(k)}return null};var f=function(a,b){return a[0]===b[0]&&a[1]===b[1]},g=function(a){return a[0]+"-"+a[1]},h=c.Map=function(){throw new Error("not instantiable, this is an interface")};h.prototype.adjacent=function(){},h.prototype.equals=f,h.prototype.hash=g,h.prototype.estimatedDistance=function(){return 1},h.prototype.actualDistance=function(){return 1}},{"./math/binaryheap":12}],18:[function(a,b,c){var d=a("../gamejs"),e=a("./utils/objects"),f=c.Mask=function(a,b){this._bits=[],b=b&&255-b||255;var c=a.getImageData().data,d=a.getSize();this.width=d[0],this.height=d[1];var e,f;for(e=0;e<this.width;e++)for(this._bits[e]=[],f=0;f<this.height;f++)this._bits[e][f]=!1;for(e=0;e<c.length;e+=4){var g=parseInt(e/4/d[0],10),h=parseInt(e/4%d[0],10),i=c[e+3];i>=b&&this.setAt(h,g)}};f.prototype.overlapRect=function(a,b){var c=this.rect,e=a.rect;if(b&&e.moveIp(b),!e.collideRect(c))return null;var f=Math.max(c.left,e.left),g=Math.min(c.right,e.right),h=Math.max(c.top,e.top),i=Math.min(c.bottom,e.bottom);return new d.Rect([f,h],[g-f,i-h])},f.prototype.overlap=function(a,b){var c=this.overlapRect(a,b);if(null===c)return!1;var d=this.rect,e=a.rect;b&&e.moveIp(b);var f,g;for(g=c.top;g<=c.bottom;g++)for(f=c.left;f<=c.right;f++)if(this.getAt(f-d.left,g-d.top)&&a.getAt(f-e.left,g-e.top))return!0;return!1},f.prototype.overlapArea=function(a,b){var c=this.overlapRect(a,b);if(null===c)return 0;var d=this.rect,e=a.rect;b&&e.moveIp(b);var f,g,h=0;for(g=c.top;g<=c.bottom;g++)for(f=c.left;f<=c.right;f++)this.getAt(f-d.left,g-d.top)&&a.getAt(f-e.left,g-e.top)&&h++;return h},f.prototype.overlapMask=function(a,b){var c=this.overlapRect(a,b);if(null===c)return 0;var e=this.rect,g=a.rect;b&&g.moveIp(b);var h,i,j=new f(new d.graphics.Surface([c.width,c.height]));for(i=c.top;i<=c.bottom;i++)for(h=c.left;h<=c.right;h++)this.getAt(h-e.left,i-e.top)&&a.getAt(h-g.left,i-g.top)&&j.setAt(h,i);return j},f.prototype.setAt=function(a,b){this._bits[a][b]=!0},f.prototype.getAt=function(a,b){return a=parseInt(a,10),b=parseInt(b,10),0>a||0>b||a>=this.width||b>=this.height?!1:this._bits[a][b]},f.prototype.invert=function(){this._bits=this._bits.map(function(a){return a.map(function(a){return!a})})},f.prototype.getSize=function(){return[this.width,this.height]},e.accessors(f.prototype,{rect:{get:function(){return new d.Rect([0,0],[this.width,this.height])}},length:{get:function(){var a=0;return this._bits.forEach(function(b){b.forEach(function(b){b&&a++})}),a}}})},{"../gamejs":2,"./utils/objects":25}],19:[function(a,b,c){function d(a){var b=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return a+"@"+(b()+b())}var e=a("../gamejs"),f=a("./utils/uri"),g=a("./utils/callback").Callback,h=c._EVENTS={RESULT:1001,ALIVE:1002,LOG:1004},i=c.inWorker=void 0!==this.importScripts;c._ready=function(){self.onmessage=function(a){e.event._triggerCallbacks(a.data)},self.postMessage({type:h.ALIVE})},c.post=function(a){if(!i)throw new Error("gamejs.postMessage only available in a thread/worker module");self.postMessage({type:h.RESULT,data:a})},c._logMessage=function(){var a=[];Array.prototype.forEach.call(arguments,function(b){a.push(b)}),self.postMessage({type:h.LOG,arguments:a})};var j=function(){__scripts.forEach(function(a){try{importScripts(a)}catch(b){}})},k=function(a){var b=f.resolve(document.location.href,window.require.getModuleRoot()),c=[];Array.prototype.slice.apply(document.getElementsByTagName("script"),[0]).forEach(function(a){a.src&&c.push(a.src)});var d=window.URL||window.webkitURL,e=j.toString();e=e.substring(e.indexOf("{")+1,e.lastIndexOf("}"));var g=new Blob(['var __scripts = ["'+c.join('","')+'"];',e,';self.require.setModuleRoot("'+b+'");','self.require.run("'+a+'");'],{type:"application/javascript"}),h=d.createObjectURL(g);return new Worker(h)};c.Worker=function(a){function b(a,b){a.forEach(function(a){a.trigger(b)})}var c=this.id=d(a),f=k(a),i=[],j=!1,l=this,m=[],n=[];return f.onmessage=function(a){a.data.type===h.ALIVE?(j=!0,i.forEach(function(a){l.post(a)})):a.data.type===h.LOG?e.logging.log.apply(null,[c].concat(a.data.arguments)):b(m,a.data.data)},f.onerror=function(a){e.logging.error('Error in worker "'+c+'" line '+a.lineno+": ",a.message),b(n,{data:a.data,worker:l,event:a})},this.onEvent=function(a,b){m.push(new g(a,b))},this.onError=function(a,b){n.push(new g(a,b))},this.post=function(a){j?f.postMessage(a):i.push(a)},this}},{"../gamejs":2,"./utils/callback":24,"./utils/uri":27}],20:[function(a,b,c){var d=a("../gamejs"),e=(a("./utils/objects"),a("./utils/xml")),f=a("./utils/base64"),g=a("./utils/uri"),h=(c.Map=function(a){a=g.resolve(document.location.href,a);var b=e.Document.fromURL(a),c=b.element("map");this.tileWidth=c.attribute("tilewidth"),this.tileHeight=c.attribute("tileheight"),this.width=c.attribute("width"),this.height=c.attribute("height");var d=c.attribute("orientation");if("orthogonal"!==d)throw new Error("only orthogonol maps supported");return this.properties={},l(this.properties,c),this.tiles=new h(c,a),this.layers=k(c),this},c.Tile=function(){throw this.surface=null,this.properties=null,new Error("Can not be instantiated.")},c.TileSets=function(a,b){var c=[];this.getSurface=function(a){var b=this.getTile(a);return b&&b.surface||null},this.getProperties=function(a){var b=this.getTile(a);return b&&b.properties||{}},this.getTile=function(a){var b=null;return c.some(function(c){return c.firstGid<=a?(b=c.tiles[a-c.firstGid],!0):!1},this),b};var f=function(a){for(var c=[],e=a.attribute("tilewidth"),f=a.attribute("tileheight"),h=a.attribute("spacing")||0,i=a.element("image"),j=i.attribute("source"),k=g.makeRelative(g.resolve(b,j)),m=d.image.load(k),n=a.elements("tile"),o=m.getSize(),p=new d.Rect([0,0],[e,f]),q=0,r=0;r+f<=o[1];){for(var s=0;s+e<=o[0];){var t=new d.graphics.Surface(e,f),u=new d.Rect([s,r],[e,f]);t.blit(m,p,u);var v={};n.some(function(a){return a.attribute("id")===q?(l(v,a),!0):void 0},this),c.push({surface:t,properties:v}),s+=e+h,q++}r+=f+h}return c};return a.elements("tileset").forEach(function(a){var d=a.attribute("firstgid"),h=a.attribute("source");if(h){var i=e.Document.fromURL(g.resolve(b,h));a=i.element("tileset")}c.push({tiles:f(a),firstGid:d})}),c.reverse(),this}),i=2147483648,j=1073741824,k=function(a){var b=[],c=function(a){var b=a.element("data"),c=b.attribute("encoding"),e=b.attribute("compression"),g="";b.children().forEach(function(a){g+=a.value()});var h=[];if("base64"===c){if(e)throw new Error("Compression of map data unsupported");h=f.decodeAsArray(g,4)}else{if("csv"!==c)throw new Error("individual tile format not supported");g.trim().split("\n").forEach(function(a){a.split(",",d).forEach(function(a){h.push(parseInt(a,10))})})}return h},d=a.attribute("width"),e=a.attribute("height");return a.elements("layer").forEach(function(a){for(var f=[],g=e;g-->0;){var h=d;for(f[g]=[];h-->0;)f[g][h]=0}c(a).forEach(function(a,b){a&=~(i|j),f[parseInt(b/d,10)][parseInt(b%d,10)]=a}),b.push({gids:f,opacity:a.attribute("opacity"),visible:a.attribute("visible"),properties:l({},a)})}),b},l=function(a,b){var c=b.element("properties");if(c)return c.elements("property").forEach(function(b){var c=b.attribute("name"),d=b.attribute("value");a[c]=d}),a},m=c.MapView=function(a){return this.timeout=0,this.layerViews=a.layers.map(function(b){return new n(b,{tileWidth:a.tileWidth,tileHeight:a.tileHeight,width:a.width,height:a.height,tiles:a.tiles})}),this.viewRect=new d.Rect([0,0],[a.width*a.tileWidth,a.height*a.tileWidth]),this.image=new d.graphics.Surface([this.viewRect.width,this.viewRect.height]),this.mapImage=this.image.clone(),this.redraw(),this};m.prototype.redraw=function(){this.layerViews.forEach(function(a){a.draw(this.mapImage)},this)},m.prototype.draw=function(a,b){a.blit(this.mapImage,b||[0,0],this.viewRect)};var n=c.LayerView=function(a,b){return this.draw=function(a){a.blit(this.surface)},this.surface=new d.graphics.Surface(b.width*b.tileWidth,b.height*b.tileHeight),this.surface.setAlpha(a.opacity),a.gids.forEach(function(a,c){a.forEach(function(a,e){if(0!==a){var f=b.tiles.getSurface(a);f?this.surface.blit(f,new d.Rect([e*b.tileWidth,c*b.tileHeight],[b.tileWidth,b.tileHeight])):d.log("no gid ",a,c,e,"layer",c)}},this)},this),this}},{"../gamejs":2,"./utils/base64":23,"./utils/objects":25,"./utils/uri":27,"./utils/xml":28}],21:[function(a,b,c){var d=(a("./utils/callback").Callback,null),e=null,f=c._CALLBACKS=[],g="undefined"!=typeof window?window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||null:null,h=function(){j(),g(h)},i=function(a){f.forEach(function(b){b.trigger(a)})};c.init=function(){e=Date.now(),g?g(h):setInterval(j,10)};var j=function(){var a=Date.now();i(a-(d||a)),d=a}},{"./utils/callback":24}],22:[function(a,b,c){c.remove=function(a,b){var c=b.indexOf(a);return-1!==c?b.splice(b.indexOf(a),1):null},c.shuffle=function(a){for(var b=a.length-1,c=b;c>0;c--){var d=parseInt(Math.random()*(c+1),10),e=a[c];a[c]=a[d],a[d]=e}return a}},{}],23:[function(a,b,c){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e=c.decode=function(a){var b,c,e,f,g,h,i,j=[],k=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");k<a.length;)f=d.indexOf(a.charAt(k++)),g=d.indexOf(a.charAt(k++)),h=d.indexOf(a.charAt(k++)),i=d.indexOf(a.charAt(k++)),b=f<<2|g>>4,c=(15&g)<<4|h>>2,e=(3&h)<<6|i,j.push(String.fromCharCode(b)),64!=h&&j.push(String.fromCharCode(c)),64!=i&&j.push(String.fromCharCode(e));return j=j.join("")};c.decodeAsArray=function(a,b){b=b||1;var c,d,f=e(a),g=f.length/b,h=[];for(c=0;g>c;c++)for(h[c]=0,d=b-1;d>=0;--d)h[c]+=f.charCodeAt(c*b+d)<<(d<<3);return h}},{}],24:[function(a,b,c){var d=c.Callback=function(a,b){return this.fn=a,this.fnScope=b||{},this};d.prototype.trigger=function(){this.fn.apply(this.fnScope,arguments)}},{}],25:[function(a,b,c){c.extend=function(a,b){if(void 0===a)throw new Error("unknown subClass");if(void 0===b)throw new Error("unknown superClass");var c;c=new Function,c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.superClass=b.prototype,a.superConstructor=b},c.merge=function(){var a,b,c={};for(a=arguments.length;a>0;--a){var d=arguments[a-1];for(b in d)c[b]=d[b]}return c};var d=c.keys=function(a){if(Object.keys)return Object.keys(a);var b,c=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c},e=c.accessor=function(a,b,c,d){void 0!==Object.defineProperty?Object.defineProperty(a,b,{get:c,set:d}):void 0!==Object.prototype.__defineGetter__&&(a.__defineGetter__(b,c),d&&a.__defineSetter__(b,d))};c.accessors=function(a,b){d(b).forEach(function(c){e(a,c,b[c].get,b[c].set)})}},{}],26:[function(a,b,c){c.getCommonPrefix=function(a,b){if(null===a||null===b)return null;if(a.length>b.length&&0===a.indexOf(b))return b;if(b.length>a.length&&0===b.indexOf(a))return a;var c,d=Math.min(a.length,b.length);for(c=0;d>c;c++)if(a[c]!=b[c])return a.slice(0,c);return a.slice(0,d)}},{}],27:[function(a,b,c){var d=new RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([\\w\\d\\-\\u0100-\\uffff.%]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),e=c.resolve=function(a,b){var c=f(a),d=f(b),e=c[1]+"://"+c[3];if(d[1])return b;c[4]&&(e=e+":"+c[4]);var h=c[5];if("/"!==b.charAt(0)){var i=h.lastIndexOf("/");h=h.substr(0,i+1)+b}else h=b;return e+g(h)},f=c.match=function(a){return a.match(d)},g=(c.makeRelative=function(a){var b=e(document.location.href,"./");return 0===a.indexOf(b)&&(a="./"+a.substring(b.length)),a},function(a){if(".."==a||"."==a)return"";var b,c=a.indexOf("/")>-1,d=a.split("/"),e=[];for(b=0;b<d.length;){var f=d[b++];"."==f?c&&b==d.length&&e.push(""):".."==f?((e.length>1||1!==e.length&&""!==e[0])&&e.pop(),c&&b==d.length&&e.push("")):(e.push(f),c=!0)}return e.join("/")})},{}],28:[function(a,b,c){var d=(c.Parser=function(){var a=null,b=new DOMParser;return this.parseFromString=function(c){return a=b.parseFromString(c,"text/xml")},this},c.Document=function(a){if(!a||!a instanceof XMLDocument)throw new Error("Need a valid xmlDocument.");return this._xmlDocument=a,this});d.prototype.element=function(a){var b=this._xmlDocument.getElementsByTagName(a)[0];return b&&new d(b)||null},d.prototype.elements=function(a){var b=this._xmlDocument.getElementsByTagName(a);return Array.prototype.slice.apply(b,[0]).map(function(a){return new d(a)})},d.prototype.attribute=function(a){var b=this._xmlDocument.getAttribute(a);if(b=b?b.trim():null,null===b)return null;if("true"===b.toLowerCase())return!0;if("false"===b.toLowerCase())return!1;var c=parseInt(b,10),d=parseFloat(b,10);return isNaN(c)?b:d!==c?d:c},d.prototype.value=function(){return this._xmlDocument.nodeValue},d.prototype.children=function(){return Array.prototype.slice.apply(this._xmlDocument.childNodes,[0]).map(function(a){return new d(a)})},d.fromString=function(a){var b=new DOMParser,c=b.parseFromString(a,"text/xml");return new d(c)},d.fromURL=function(a){var b=new XMLHttpRequest;return b.open("GET",a,!1),b.setRequestHeader("X-Requested-With","XMLHttpRequest"),b.setRequestHeader("Content-Type","text/xml"),b.overrideMimeType("text/xml"),b.send(),new d(b.responseXML)}},{}],29:[function(a,b){"use strict";function c(a,b){for(var c=0,d=a.length,e=0;d>e;++e)c+=a[e]*b[e];return c}function d(a){var b=a.length;if(0===b)return[];var d=(a[0].length,f([a.length+1,a.length+1],1)),e=f([a.length+1],1);d[b][b]=0;for(var h=0;b>h;++h){for(var i=0;h>=i;++i)d[i][h]=d[h][i]=2*c(a[h],a[i]);e[h]=c(a[h],a[h])}for(var j=g(d,e),k=0,l=j[b+1],h=0;h<l.length;++h)k+=l[h];for(var m=new Array(b),h=0;b>h;++h){for(var l=j[h],n=0,i=0;i<l.length;++i)n+=l[i];m[h]=n/k}return m}function e(a){if(0===a.length)return[];for(var b=a[0].length,c=f([b]),e=d(a),g=0;g<a.length;++g)for(var h=0;b>h;++h)c[h]+=a[g][h]*e[g];return c}var f=a("dup"),g=a("robust-linear-solve");e.barycenetric=d,b.exports=e},{dup:30,"robust-linear-solve":31}],30:[function(a,b){"use strict";function c(a,b,d){var e=0|a[d];if(0>=e)return[];var f,g=new Array(e);if(d===a.length-1)for(f=0;e>f;++f)g[f]=b;else for(f=0;e>f;++f)g[f]=c(a,b,d+1);return g}function d(a,b){var c,d;for(c=new Array(a),d=0;a>d;++d)c[d]=b;return c}function e(a,b){switch("undefined"==typeof b&&(b=0),typeof a){case"number":if(a>0)return d(0|a,b);break;case"object":if("number"==typeof a.length)return c(a,b,0)}return[]}b.exports=e},{}],31:[function(a,b){"use strict";function c(a){for(var b="robustLinearSolve"+a+"d",c=["function ",b,"(A,b){return ["],d=0;a>d;++d){c.push("det([");for(var e=0;a>e;++e){e>0&&c.push(","),c.push("[");for(var f=0;a>f;++f)f>0&&c.push(","),f===d?c.push("+b[",e,"]"):c.push("+A[",e,"][",f,"]");c.push("]")}c.push("]),")}c.push("det(A)]}return ",b);var h=new Function("det",c.join(""));return h(6>a?g[a]:g)}function d(){return[0]}function e(a,b){return[[b[0]],[a[0][0]]]}function f(){for(;i.length<h;)i.push(c(i.length));for(var a=[],d=["function dispatchLinearSolve(A,b){switch(A.length){"],e=0;h>e;++e)a.push("s"+e),d.push("case ",e,":return s",e,"(A,b);");d.push("}var s=CACHE[A.length];if(!s)s=CACHE[A.length]=g(A.length);return s(A,b)}return dispatchLinearSolve"),a.push("CACHE","g",d.join(""));var f=Function.apply(void 0,a);b.exports=f.apply(void 0,i.concat([i,c]));for(var e=0;h>e;++e)b.exports[e]=i[e]}var g=a("robust-determinant"),h=6,i=[d,e];f()},{"robust-determinant":37}],32:[function(a,b){"use strict";function c(a){for(var b=a.length,c=a[a.length-1],d=b,e=b-2;e>=0;--e){var f=c,g=a[e];c=f+g;var h=c-f,i=g-h;i&&(a[--d]=c,c=i)}for(var j=0,e=d;b>e;++e){var f=a[e],g=c;c=f+g;var h=c-f,i=g-h;i&&(a[j++]=i)}return a[j++]=c,a.length=j,a}b.exports=c},{}],33:[function(a,b){"use strict";function c(a,b,c){var d=a+b,e=d-a,f=d-e,g=b-e,h=a-f;return c?(c[0]=h+g,c[1]=d,c):[h+g,d]}b.exports=c},{}],34:[function(a,b){"use strict";function c(a,b){var c=a.length;if(1===c){var f=d(a[0],b);return f[0]?f:[f[1]]}var g=new Array(2*c),h=[.1,.1],i=[.1,.1],j=0;d(a[0],b,h),h[0]&&(g[j++]=h[0]);for(var k=1;c>k;++k){d(a[k],b,i);var l=h[1];e(l,i[0],h),h[0]&&(g[j++]=h[0]);var m=i[1],n=h[1],o=m+n,p=o-m,q=n-p;h[1]=o,q&&(g[j++]=q)}return h[1]&&(g[j++]=h[1]),0===j&&(g[j++]=0),g.length=j,g}var d=a("two-product"),e=a("two-sum");b.exports=c},{"two-product":36,"two-sum":33}],35:[function(a,b){"use strict";function c(a,b){var c=a+b,d=c-a,e=c-d,f=b-d,g=a-e,h=g+f;return h?[h,c]:[c]}function d(a,b){var d=0|a.length,e=0|b.length;if(1===d&&1===e)return c(a[0],b[0]);var f,g,h=d+e,i=new Array(h),j=0,k=0,l=0,m=Math.abs,n=a[k],o=m(n),p=b[l],q=m(p);q>o?(g=n,k+=1,d>k&&(n=a[k],o=m(n))):(g=p,l+=1,e>l&&(p=b[l],q=m(p))),d>k&&q>o||l>=e?(f=n,k+=1,d>k&&(n=a[k],o=m(n))):(f=p,l+=1,e>l&&(p=b[l],q=m(p)));for(var r,s,t,u,v,w=f+g,x=w-f,y=g-x,z=y,A=w;d>k&&e>l;)q>o?(f=n,k+=1,d>k&&(n=a[k],o=m(n))):(f=p,l+=1,e>l&&(p=b[l],q=m(p))),g=z,w=f+g,x=w-f,y=g-x,y&&(i[j++]=y),r=A+w,s=r-A,t=r-s,u=w-s,v=A-t,z=v+u,A=r;for(;d>k;)f=n,g=z,w=f+g,x=w-f,y=g-x,y&&(i[j++]=y),r=A+w,s=r-A,t=r-s,u=w-s,v=A-t,z=v+u,A=r,k+=1,d>k&&(n=a[k]);for(;e>l;)f=p,g=z,w=f+g,x=w-f,y=g-x,y&&(i[j++]=y),r=A+w,s=r-A,t=r-s,u=w-s,v=A-t,z=v+u,A=r,l+=1,e>l&&(p=b[l]);return z&&(i[j++]=z),A&&(i[j++]=A),j||(i[j++]=0),i.length=j,i}b.exports=d},{}],36:[function(a,b){"use strict";function c(a,b,c){var e=a*b,f=d*a,g=f-a,h=f-g,i=a-h,j=d*b,k=j-b,l=j-k,m=b-l,n=e-h*l,o=n-i*l,p=o-h*m,q=i*m-p;return c?(c[0]=q,c[1]=e,c):[q,e]}b.exports=c;var d=+(Math.pow(2,27)+1)},{}],37:[function(a,b){"use strict";function c(a,b){for(var c=new Array(a.length-1),d=1;d<a.length;++d)for(var e=c[d-1]=new Array(a.length-1),f=0,g=0;f<a.length;++f)f!==b&&(e[g++]=a[d][f]);return c}function d(a){for(var b=new Array(a),c=0;a>c;++c){b[c]=new Array(a);for(var d=0;a>d;++d)b[c][d]=["m[",c,"][",d,"]"].join("")}return b}function e(a){return 1&a?"-":""}function f(a){if(1===a.length)return a[0];if(2===a.length)return["sum(",a[0],",",a[1],")"].join("");var b=a.length>>1;return["sum(",f(a.slice(0,b)),",",f(a.slice(b)),")"].join("")}function g(a){if(2===a.length)return["sum(prod(",a[0][0],",",a[1][1],"),prod(-",a[0][1],",",a[1][0],"))"].join("");for(var b=[],d=0;d<a.length;++d)b.push(["scale(",g(c(a,d)),",",e(d),a[0][d],")"].join(""));return f(b)}function h(a){var b=new Function("sum","scale","prod","compress",["function robustDeterminant",a,"(m){return compress(",g(d(a)),")};return robustDeterminant",a].join(""));return b(k,l,j,m)}function i(){for(;o.length<n;)o.push(h(o.length));for(var a=[],c=["function robustDeterminant(m){switch(m.length){"],d=0;n>d;++d)a.push("det"+d),c.push("case ",d,":return det",d,"(m);");c.push("}var det=CACHE[m.length];if(!det)det=CACHE[m.length]=gen(m.length);return det(m);}return robustDeterminant"),a.push("CACHE","gen",c.join(""));var e=Function.apply(void 0,a);b.exports=e.apply(void 0,o.concat([o,h]));for(var d=0;d<o.length;++d)b.exports[d]=o[d]}var j=a("two-product"),k=a("robust-sum"),l=a("robust-scale"),m=a("robust-compress"),n=6,o=[function(){return[0]},function(a){return[a[0][0]]}];i()},{"robust-compress":32,"robust-scale":34,"robust-sum":35,"two-product":36}],38:[function(a,b){"use strict";function c(a,b,c){this.vertices=a,this.adjacent=b,this.boundary=c,this.lastVisited=-1}function d(a,b,c){this.vertices=a,this.cell=b,this.index=c}function e(a,b){return j(a.vertices,b.vertices)}function f(a){for(var b=["function orient(){var tuple=this.tuple;return test("],c=0;a>=c;++c)c>0&&b.push(","),b.push("tuple[",c,"]");b.push(")}return orient");var d=new Function("test",b.join("")),e=i[a+1];return e||(e=i),d(e)}function g(a,b,c){this.dimension=a,this.vertices=b,this.simplices=c,this.interior=c.filter(function(a){return!a.boundary}),this.tuple=new Array(a+1);for(var d=0;a>=d;++d)this.tuple[d]=this.vertices[d];var e=k[a];e||(e=k[a]=f(a)),this.orient=e}function h(a,b){var d=a.length;if(0===d)throw new Error("Must have at least d+1 points");var e=a[0].length;if(e>=d)throw new Error("Must input at least d+1 points");var f=a.slice(0,e+1),h=i.apply(void 0,f);if(0===h)throw new Error("Input not in general position");for(var j=new Array(e+1),k=0;e>=k;++k)j[k]=k;0>h&&(j[0]=1,j[1]=0);for(var l=new c(j,new Array(e+1),!1),m=l.adjacent,n=new Array(e+2),k=0;e>=k;++k){for(var o=j.slice(),p=0;e>=p;++p)p===k&&(o[p]=-1);var q=o[0];o[0]=o[1],o[1]=q;var r=new c(o,new Array(e+1),!0);m[k]=r,n[k]=r}n[e+1]=l;for(var k=0;e>=k;++k)for(var o=m[k].vertices,s=m[k].adjacent,p=0;e>=p;++p){var t=o[p];if(0>t)s[p]=l;else for(var u=0;e>=u;++u)m[u].vertices.indexOf(t)<0&&(s[p]=m[u])}for(var v=new g(e,f,n),w=!!b,k=e+1;d>k;++k)v.insert(a[k],w);return v.boundary()}b.exports=h;var i=a("robust-orientation"),j=a("simplicial-complex").compareCells;c.prototype.flip=function(){var a=this.vertices[0];this.vertices[0]=this.vertices[1],this.vertices[1]=a;var b=this.adjacent[0];this.adjacent[0]=this.adjacent[1],this.adjacent[1]=b};var k=[],l=g.prototype;l.handleBoundaryDegeneracy=function(a,b){var c=this.dimension,d=this.vertices.length-1,e=this.tuple,f=this.vertices,g=[a];for(a.lastVisited=-d;g.length>0;){a=g.pop();for(var h=(a.vertices,a.adjacent),i=0;c>=i;++i){var j=h[i];if(j.boundary&&!(j.lastVisited<=-d)){for(var k=j.vertices,l=0;c>=l;++l){var m=k[l];e[l]=0>m?b:f[m]}var n=this.orient();if(n>0)return j;j.lastVisited=-d,0===n&&g.push(j)}}}return null},l.walk=function(a,b){var c=this.vertices.length-1,d=this.dimension,e=this.vertices,f=this.tuple,g=b?this.interior.length*Math.random()|0:this.interior.length-1,h=this.interior[g];a:for(;!h.boundary;){for(var i=h.vertices,j=h.adjacent,k=0;d>=k;++k)f[k]=e[i[k]];h.lastVisited=c;for(var k=0;d>=k;++k){var l=j[k];if(!(l.lastVisited>=c)){var m=f[k];f[k]=a;var n=this.orient();if(f[k]=m,0>n){h=l;continue a}l.lastVisited=l.boundary?-c:c}}return}return h},l.addPeaks=function(a,b){var f=this.vertices.length-1,g=this.dimension,h=this.vertices,i=this.tuple,j=this.interior,k=this.simplices,l=[b];b.lastVisited=f,b.vertices[b.vertices.indexOf(-1)]=f,b.boundary=!1,j.push(b);for(var m=[];l.length>0;){var b=l.pop(),n=b.vertices,o=b.adjacent,p=n.indexOf(f);if(!(0>p))for(var q=0;g>=q;++q)if(q!==p){var r=o[q];if(r.boundary&&!(r.lastVisited>=f)){var s=r.vertices;if(r.lastVisited!==-f){for(var t=0,u=0;g>=u;++u)s[u]<0?(t=u,i[u]=a):i[u]=h[s[u]];var v=this.orient();if(v>0){s[t]=f,r.boundary=!1,j.push(r),l.push(r),r.lastVisited=f;continue}r.lastVisited=-f}var w=r.adjacent,x=n.slice(),y=o.slice(),z=new c(x,y,!0);k.push(z);var A=w.indexOf(b);if(!(0>A)){w[A]=z,y[p]=r,x[q]=-1,y[q]=b,o[q]=z,z.flip();for(var u=0;g>=u;++u){var B=x[u];if(!(0>B||B===f)){for(var C=new Array(g-1),D=0,E=0;g>=E;++E){var F=x[E];0>F||E===u||(C[D++]=F)}m.push(new d(C,z,u))}}}}}}m.sort(e);for(var q=0;q+1<m.length;q+=2){var G=m[q],H=m[q+1],I=G.index,J=H.index;0>I||0>J||(G.cell.adjacent[G.index]=H.cell,H.cell.adjacent[H.index]=G.cell)}},l.insert=function(a,b){var c=this.vertices;c.push(a);var d=this.walk(a,b);if(d){for(var e=this.dimension,f=this.tuple,g=0;e>=g;++g){var h=d.vertices[g];f[g]=0>h?a:c[h]}var i=this.orient(f);0>i||(0!==i||(d=this.handleBoundaryDegeneracy(d,a)))&&this.addPeaks(a,d)}},l.boundary=function(){for(var a=this.dimension,b=[],c=this.simplices,d=c.length,e=0;d>e;++e){var f=c[e];if(f.boundary){for(var g=new Array(a),h=f.vertices,i=0,j=0,k=0;a>=k;++k)h[k]>=0?g[i++]=h[k]:j=1&k;if(j===(1&a)){var l=g[0];g[0]=g[1],g[1]=l}b.push(g)}}return b}},{"robust-orientation":44,"simplicial-complex":47}],39:[function(a,b,c){arguments[4][33][0].apply(c,arguments)},{dup:33}],40:[function(a,b,c){arguments[4][34][0].apply(c,arguments)},{dup:34,"two-product":43,"two-sum":39}],41:[function(a,b){"use strict";function c(a,b){var c=a+b,d=c-a,e=c-d,f=b-d,g=a-e,h=g+f;return h?[h,c]:[c]}function d(a,b){var d=0|a.length,e=0|b.length;if(1===d&&1===e)return c(a[0],-b[0]);var f,g,h=d+e,i=new Array(h),j=0,k=0,l=0,m=Math.abs,n=a[k],o=m(n),p=-b[l],q=m(p);q>o?(g=n,k+=1,d>k&&(n=a[k],o=m(n))):(g=p,l+=1,e>l&&(p=-b[l],q=m(p))),d>k&&q>o||l>=e?(f=n,k+=1,d>k&&(n=a[k],o=m(n))):(f=p,l+=1,e>l&&(p=-b[l],q=m(p)));for(var r,s,t,u,v,w=f+g,x=w-f,y=g-x,z=y,A=w;d>k&&e>l;)q>o?(f=n,k+=1,d>k&&(n=a[k],o=m(n))):(f=p,l+=1,e>l&&(p=-b[l],q=m(p))),g=z,w=f+g,x=w-f,y=g-x,y&&(i[j++]=y),r=A+w,s=r-A,t=r-s,u=w-s,v=A-t,z=v+u,A=r;for(;d>k;)f=n,g=z,w=f+g,x=w-f,y=g-x,y&&(i[j++]=y),r=A+w,s=r-A,t=r-s,u=w-s,v=A-t,z=v+u,A=r,k+=1,d>k&&(n=a[k]);for(;e>l;)f=p,g=z,w=f+g,x=w-f,y=g-x,y&&(i[j++]=y),r=A+w,s=r-A,t=r-s,u=w-s,v=A-t,z=v+u,A=r,l+=1,e>l&&(p=-b[l]);return z&&(i[j++]=z),A&&(i[j++]=A),j||(i[j++]=0),i.length=j,i}b.exports=d},{}],42:[function(a,b,c){arguments[4][35][0].apply(c,arguments)},{dup:35}],43:[function(a,b,c){arguments[4][36][0].apply(c,arguments)},{dup:36}],44:[function(a,b){"use strict";function c(a,b){for(var c=new Array(a.length-1),d=1;d<a.length;++d)for(var e=c[d-1]=new Array(a.length-1),f=0,g=0;f<a.length;++f)f!==b&&(e[g++]=a[d][f]);return c}function d(a){for(var b=new Array(a),c=0;a>c;++c){b[c]=new Array(a);for(var d=0;a>d;++d)b[c][d]=["m",d,"[",a-c-1,"]"].join("")}return b}function e(a){return 1&a?"-":""}function f(a){if(1===a.length)return a[0];if(2===a.length)return["sum(",a[0],",",a[1],")"].join("");var b=a.length>>1;return["sum(",f(a.slice(0,b)),",",f(a.slice(b)),")"].join("")}function g(a){if(2===a.length)return[["sum(prod(",a[0][0],",",a[1][1],"),prod(-",a[0][1],",",a[1][0],"))"].join("")];for(var b=[],d=0;d<a.length;++d)b.push(["scale(",f(g(c(a,d))),",",e(d),a[0][d],")"].join(""));return b}function h(a){for(var b=[],e=[],h=d(a),i=[],j=0;a>j;++j)0===(1&j)?b.push.apply(b,g(c(h,j))):e.push.apply(e,g(c(h,j))),i.push("m"+j);var o=f(b),p=f(e),q="orientation"+a+"Exact",r=["function ",q,"(",i.join(),"){var p=",o,",n=",p,",d=sub(p,n);return d[d.length-1];};return ",q].join(""),s=new Function("sum","prod","scale","sub",r);return s(l,k,m,n)}function i(a){var b=u[a.length];return b||(b=u[a.length]=h(a.length)),b.apply(void 0,a)}function j(){for(;u.length<=o;)u.push(h(u.length));for(var a=[],c=["slow"],d=0;o>=d;++d)a.push("a"+d),c.push("o"+d);for(var e=["function getOrientation(",a.join(),"){switch(arguments.length){case 0:case 1:return 0;"],d=2;o>=d;++d)e.push("case ",d,":return o",d,"(",a.slice(0,d).join(),");");e.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),c.push(e.join(""));var f=Function.apply(void 0,c);b.exports=f.apply(void 0,[i].concat(u));for(var d=0;o>=d;++d)b.exports[d]=u[d]}var k=a("two-product"),l=a("robust-sum"),m=a("robust-scale"),n=a("robust-subtract"),o=5,p=1.1102230246251565e-16,q=(3+16*p)*p,r=(7+56*p)*p,s=h(3),t=h(4),u=[function(){return 0},function(){return 0},function(a,b){return b[0]-a[0]},function(a,b,c){var d,e=(a[1]-c[1])*(b[0]-c[0]),f=(a[0]-c[0])*(b[1]-c[1]),g=e-f;if(e>0){if(0>=f)return g;d=e+f}else{if(!(0>e))return g;if(f>=0)return g;d=-(e+f)}var h=q*d;return g>=h||-h>=g?g:s(a,b,c)},function(a,b,c,d){var e=a[0]-d[0],f=b[0]-d[0],g=c[0]-d[0],h=a[1]-d[1],i=b[1]-d[1],j=c[1]-d[1],k=a[2]-d[2],l=b[2]-d[2],m=c[2]-d[2],n=f*j,o=g*i,p=g*h,q=e*j,s=e*i,u=f*h,v=k*(n-o)+l*(p-q)+m*(s-u),w=(Math.abs(n)+Math.abs(o))*Math.abs(k)+(Math.abs(p)+Math.abs(q))*Math.abs(l)+(Math.abs(s)+Math.abs(u))*Math.abs(m),x=r*w;
return v>x||-v>x?v:t(a,b,c,d)}];j()},{"robust-scale":40,"robust-subtract":41,"robust-sum":42,"two-product":43}],45:[function(a,b,c){"use strict";"use restrict";function d(a){var b=32;return a&=-a,a&&b--,65535&a&&(b-=16),16711935&a&&(b-=8),252645135&a&&(b-=4),858993459&a&&(b-=2),1431655765&a&&(b-=1),b}var e=32;c.INT_BITS=e,c.INT_MAX=2147483647,c.INT_MIN=-1<<e-1,c.sign=function(a){return(a>0)-(0>a)},c.abs=function(a){var b=a>>e-1;return(a^b)-b},c.min=function(a,b){return b^(a^b)&-(b>a)},c.max=function(a,b){return a^(a^b)&-(b>a)},c.isPow2=function(a){return!(a&a-1||!a)},c.log2=function(a){var b,c;return b=(a>65535)<<4,a>>>=b,c=(a>255)<<3,a>>>=c,b|=c,c=(a>15)<<2,a>>>=c,b|=c,c=(a>3)<<1,a>>>=c,b|=c,b|a>>1},c.log10=function(a){return a>=1e9?9:a>=1e8?8:a>=1e7?7:a>=1e6?6:a>=1e5?5:a>=1e4?4:a>=1e3?3:a>=100?2:a>=10?1:0},c.popCount=function(a){return a-=a>>>1&1431655765,a=(858993459&a)+(a>>>2&858993459),16843009*(a+(a>>>4)&252645135)>>>24},c.countTrailingZeros=d,c.nextPow2=function(a){return a+=0===a,--a,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a+1},c.prevPow2=function(a){return a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a-(a>>>1)},c.parity=function(a){return a^=a>>>16,a^=a>>>8,a^=a>>>4,a&=15,27030>>>a&1};var f=new Array(256);!function(a){for(var b=0;256>b;++b){var c=b,d=b,e=7;for(c>>>=1;c;c>>>=1)d<<=1,d|=1&c,--e;a[b]=d<<e&255}}(f),c.reverse=function(a){return f[255&a]<<24|f[a>>>8&255]<<16|f[a>>>16&255]<<8|f[a>>>24&255]},c.interleave2=function(a,b){return a&=65535,a=16711935&(a|a<<8),a=252645135&(a|a<<4),a=858993459&(a|a<<2),a=1431655765&(a|a<<1),b&=65535,b=16711935&(b|b<<8),b=252645135&(b|b<<4),b=858993459&(b|b<<2),b=1431655765&(b|b<<1),a|b<<1},c.deinterleave2=function(a,b){return a=a>>>b&1431655765,a=858993459&(a|a>>>1),a=252645135&(a|a>>>2),a=16711935&(a|a>>>4),a=65535&(a|a>>>16),a<<16>>16},c.interleave3=function(a,b,c){return a&=1023,a=4278190335&(a|a<<16),a=251719695&(a|a<<8),a=3272356035&(a|a<<4),a=1227133513&(a|a<<2),b&=1023,b=4278190335&(b|b<<16),b=251719695&(b|b<<8),b=3272356035&(b|b<<4),b=1227133513&(b|b<<2),a|=b<<1,c&=1023,c=4278190335&(c|c<<16),c=251719695&(c|c<<8),c=3272356035&(c|c<<4),c=1227133513&(c|c<<2),a|c<<2},c.deinterleave3=function(a,b){return a=a>>>b&1227133513,a=3272356035&(a|a>>>2),a=251719695&(a|a>>>4),a=4278190335&(a|a>>>8),a=1023&(a|a>>>16),a<<22>>22},c.nextCombination=function(a){var b=a|a-1;return b+1|(~b&-~b)-1>>>d(a)+1}},{}],46:[function(a,b){"use strict";"use restrict";function c(a){this.roots=new Array(a),this.ranks=new Array(a);for(var b=0;a>b;++b)this.roots[b]=b,this.ranks[b]=0}b.exports=c;var d=c.prototype;Object.defineProperty(d,"length",{get:function(){return this.roots.length}}),d.makeSet=function(){var a=this.roots.length;return this.roots.push(a),this.ranks.push(0),a},d.find=function(a){for(var b=this.roots;b[a]!==a;){var c=b[a];b[a]=b[c],a=c}return a},d.link=function(a,b){var c=this.find(a),d=this.find(b);if(c!==d){var e=this.ranks,f=this.roots,g=e[c],h=e[d];h>g?f[c]=d:g>h?f[d]=c:(f[d]=c,++e[c])}}},{}],47:[function(a,b,c){"use strict";"use restrict";function d(a){for(var b=0,c=Math.max,d=0,e=a.length;e>d;++d)b=c(b,a[d].length);return b-1}function e(a){for(var b=-1,c=Math.max,d=0,e=a.length;e>d;++d)for(var f=a[d],g=0,h=f.length;h>g;++g)b=c(b,f[g]);return b+1}function f(a){for(var b=new Array(a.length),c=0,d=a.length;d>c;++c)b[c]=a[c].slice(0);return b}function g(a,b){var c=a.length,d=a.length-b.length,e=Math.min;if(d)return d;switch(c){case 0:return 0;case 1:return a[0]-b[0];case 2:var f=a[0]+a[1]-b[0]-b[1];return f?f:e(a[0],a[1])-e(b[0],b[1]);case 3:var g=a[0]+a[1],h=b[0]+b[1];if(f=g+a[2]-(h+b[2]))return f;var i=e(a[0],a[1]),j=e(b[0],b[1]),f=e(i,a[2])-e(j,b[2]);return f?f:e(i+a[2],g)-e(j+b[2],h);default:var k=a.slice(0);k.sort();var l=b.slice(0);l.sort();for(var m=0;c>m;++m)if(d=k[m]-l[m])return d;return 0}}function h(a,b){return g(a[0],b[0])}function i(a,b){if(b){for(var c=a.length,d=new Array(c),e=0;c>e;++e)d[e]=[a[e],b[e]];d.sort(h);for(var e=0;c>e;++e)a[e]=d[e][0],b[e]=d[e][1];return a}return a.sort(g),a}function j(a){if(0===a.length)return[];for(var b=1,c=a.length,d=1;c>d;++d){var e=a[d];if(g(e,a[d-1])){if(d===b){b++;continue}a[b++]=e}}return a.length=b,a}function k(a,b){for(var c=0,d=a.length-1,e=-1;d>=c;){var f=c+d>>1,h=g(a[f],b);0>=h?(0===h&&(e=f),c=f+1):h>0&&(d=f-1)}return e}function l(a,b){for(var c=new Array(a.length),d=0,e=c.length;e>d;++d)c[d]=[];for(var f=[],d=0,h=b.length;h>d;++d)for(var i=b[d],j=i.length,l=1,m=1<<j;m>l;++l){f.length=t.popCount(l);for(var n=0,o=0;j>o;++o)l&1<<o&&(f[n++]=i[o]);var p=k(a,f);if(!(0>p))for(;;)if(c[p++].push(d),p>=a.length||0!==g(a[p],f))break}return c}function m(a,b){if(!b)return l(j(o(a,0)),a,0);for(var c=new Array(b),d=0;b>d;++d)c[d]=[];for(var d=0,e=a.length;e>d;++d)for(var f=a[d],g=0,h=f.length;h>g;++g)c[f[g]].push(d);return c}function n(a){for(var b=[],c=0,d=a.length;d>c;++c)for(var e=a[c],f=0|e.length,g=1,h=1<<f;h>g;++g){for(var j=[],k=0;f>k;++k)g>>>k&1&&j.push(e[k]);b.push(j)}return i(b)}function o(a,b){if(0>b)return[];for(var c=[],d=(1<<b+1)-1,e=0;e<a.length;++e)for(var f=a[e],g=d;g<1<<f.length;g=t.nextCombination(g)){for(var h=new Array(b+1),j=0,k=0;k<f.length;++k)g&1<<k&&(h[j++]=f[k]);c.push(h)}return i(c)}function p(a){for(var b=[],c=0,d=a.length;d>c;++c)for(var e=a[c],f=0,g=e.length;g>f;++f){for(var h=new Array(e.length-1),j=0,k=0;g>j;++j)j!==f&&(h[k++]=e[j]);b.push(h)}return i(b)}function q(a,b){for(var c=new u(b),d=0;d<a.length;++d)for(var e=a[d],f=0;f<e.length;++f)for(var g=f+1;g<e.length;++g)c.link(e[f],e[g]);for(var h=[],i=c.ranks,d=0;d<i.length;++d)i[d]=-1;for(var d=0;d<a.length;++d){var j=c.find(a[d][0]);i[j]<0?(i[j]=h.length,h.push([a[d].slice(0)])):h[i[j]].push(a[d].slice(0))}return h}function r(a){for(var b=j(i(o(a,0))),c=new u(b.length),d=0;d<a.length;++d)for(var e=a[d],f=0;f<e.length;++f)for(var g=k(b,[e[f]]),h=f+1;h<e.length;++h)c.link(g,k(b,[e[h]]));for(var l=[],m=c.ranks,d=0;d<m.length;++d)m[d]=-1;for(var d=0;d<a.length;++d){var n=c.find(k(b,[a[d][0]]));m[n]<0?(m[n]=l.length,l.push([a[d].slice(0)])):l[m[n]].push(a[d].slice(0))}return l}function s(a,b){return b?q(a,b):r(a)}var t=a("bit-twiddle"),u=a("union-find");c.dimension=d,c.countVertices=e,c.cloneCells=f,c.compareCells=g,c.normalize=i,c.unique=j,c.findCell=k,c.incidence=l,c.dual=m,c.explode=n,c.skeleton=o,c.boundary=p,c.connectedComponents=s},{"bit-twiddle":45,"union-find":46}],48:[function(a,b){"use strict";function c(a,b){this.point=a,this.index=b}function d(a,b){for(var c=a.point,d=b.point,e=c.length,f=0;e>f;++f){var g=d[f]-c[f];if(g)return g}return 0}function e(a,b,c){if(1===a)return c?[[-1,0]]:[];var d=b.map(function(a,b){return[a[0],b]});d.sort(function(a,b){return a[0]-b[0]});for(var e=new Array(a-1),f=1;a>f;++f){var g=d[f-1],h=d[f];e[f-1]=[g[1],h[1]]}return c&&e.push([-1,e[0][1]],[e[a-1][1],-1]),e}function f(a,b){var f=a.length;if(0===f)return[];var i=a[0].length;if(1>i)return[];if(1===i)return e(f,a,b);for(var j=new Array(f),k=1,l=0;f>l;++l){for(var m=a[l],n=new Array(i+1),o=0,p=0;i>p;++p){var q=m[p];n[p]=q,o+=q*q}n[i]=o,j[l]=new c(n,l),k=Math.max(o,k)}h(j,d),f=j.length;for(var r=new Array(f+i+1),s=new Array(f+i+1),t=(i+1)*(i+1)*k,u=new Array(i+1),l=0;i>=l;++l)u[l]=0;u[i]=t,r[0]=u.slice(),s[0]=-1;for(var l=0;i>=l;++l){var n=u.slice();n[l]=1,r[l+1]=n,s[l+1]=-1}for(var l=0;f>l;++l){var v=j[l];r[l+i+1]=v.point,s[l+i+1]=v.index}var w=g(r,!1);if(w=w.filter(b?function(a){for(var b=0,c=0;i>=c;++c){var d=s[a[c]];if(0>d&&++b>=2)return!1;a[c]=d}return!0}:function(a){for(var b=0;i>=b;++b){var c=s[a[b]];if(0>c)return!1;a[b]=c}return!0}),1&i)for(var l=0;l<w.length;++l){var v=w[l],n=v[0];v[0]=v[1],v[1]=n}return w}var g=a("incremental-convex-hull"),h=a("uniq");b.exports=f},{"incremental-convex-hull":38,uniq:49}],49:[function(a,b){"use strict";function c(a,b){for(var c=1,d=a.length,e=a[0],f=a[0],g=1;d>g;++g)if(f=e,e=a[g],b(e,f)){if(g===c){c++;continue}a[c++]=e}return a.length=c,a}function d(a){for(var b=1,c=a.length,d=a[0],e=a[0],f=1;c>f;++f,e=d)if(e=d,d=a[f],d!==e){if(f===b){b++;continue}a[b++]=d}return a.length=b,a}function e(a,b,e){return 0===a.length?a:b?(e||a.sort(b),c(a,b)):(e||a.sort(),d(a))}b.exports=e},{}],50:[function(a,b){"use strict";function c(a,b){return a-b}function d(a){if(1===a.length)return{cells:[[-1]],positions:[]};var b=a.map(function(a,b){return[a[0],b]});b.sort(function(a,b){return a-b});for(var c=new Array(a.length),d=0;d<c.length;++d)c[d]=[-1,-1];for(var e=[],f=1;f<b.length;++f){var g=b[f-1],h=b[f],i=.5*(g[0]+h[0]),j=e.length;e.push([i]),c[g[1]][1]=j,c[h[1]][0]=j}return c[b[0][1]][1]=0,c[b[b.length-1][1]][0]=e.length-1,{cells:c,positions:e}}function e(a){var b=a.length;if(0===b)return{cells:[],positions:[]};var e=a[0].length;if(1>e)return{cells:[],positions:[]};if(1===e)return d(a);for(var i=f(a,!0),j=new Array(b),k=0;b>k;++k)j[k]=[];for(var l=i.length,m=new Array(e+1),n=new Array(l),o=[],k=0;l>k;++k){for(var p=i[k],q=!1,r=0;e>=r;++r){var s=p[r];0>s?(n[k]=-1,q=!0):(j[s].push(k),m[r]=a[s])}q||(n[k]=o.length,o.push(g(m)))}var t;if(2===e){t=new Array(b);for(var k=0;b>k;++k){for(var u=j[k],v=[n[u[0]]],w=i[u[0]][(i[u[0]].indexOf(k)+1)%3],r=1;r<u.length;++r)for(var x=1;x<u.length;++x){var y=(i[u[x]].indexOf(k)+2)%3;if(i[u[x]][y]===w){v.push(n[u[x]]),w=i[u[x]][(y+2)%3];break}}t[k]=v}}else{for(var k=0;b>k;++k){for(var w=j[k],r=0;r<w.length;++r)w[r]=n[w[r]];h(w,c)}t=j}return{cells:t,positions:o}}var f=a("delaunay-triangulate"),g=a("circumcenter"),h=a("uniq");b.exports=e},{circumcenter:29,"delaunay-triangulate":48,uniq:49}],51:[function(a,b){function c(){var a,b,c,d,e,f,g,h,i,j,m,n,o,p={min:0,max:255,seed:0};if(6===arguments.length){if(!(arguments[4]instanceof Array&&arguments[5]instanceof Array&&arguments[4].length>=3&&arguments[5].length>=3))throw new Error("Improper arguments for noise surface");o=arguments[0],a=arguments[1],b=arguments[2],c=arguments[3],e=arguments[4][0],f=arguments[4][1],g=arguments[4][2],i=arguments[5][0],j=arguments[5][1],m=arguments[5][2],arguments[4].length>3&&(h=arguments[4][3]),arguments[5].length>3&&(n=arguments[5][3])}else if(5===arguments.length){if(o=arguments[0],arguments[1]instanceof Array?(a=arguments[1][0],b=arguments[1][1],c=arguments[2]):(a=arguments[1],b=arguments[2]),!(arguments[3]instanceof Array&&arguments[4]instanceof Array&&arguments[3].length>=3&&arguments[4].length>=3))throw new Error("Improper arguments for noise surface");e=arguments[3][0],f=arguments[3][1],g=arguments[3][2],i=arguments[4][0],j=arguments[4][1],m=arguments[4][2],arguments[3].length>3&&(h=arguments[3][3]),arguments[4].length>3&&(n=arguments[4][3])}else{if(4!==arguments.length)throw new Error("Improper arguments for noise surface");if(o=arguments[0],!(arguments[1]instanceof Array))throw new Error("Improper arguments for noise surface");if(a=arguments[1][0],b=arguments[1][1],!(arguments[2]instanceof Array&&arguments[3]instanceof Array&&arguments[2].length>=3&&arguments[3].length>=3))throw new Error("Improper arguments for noise surface");e=arguments[2][0],f=arguments[2][1],g=arguments[2][2],i=arguments[3][0],j=arguments[3][1],m=arguments[3][2],arguments[2].length>3&&(h=arguments[2][3]),arguments[3].length>3&&(n=arguments[3][3])}e=e||p.min,f=f||p.min,g=g||p.min,h=h||p.min,i=i||0===i?i:p.max,j=j||0===j?j:p.max,m=m||0===m?m:p.max,n=n||0===n?n:p.max,c=c||p.seed,d=l.Alea(c),o=new k([a,b]);var q,r,s,t,u,v;for(e===i&&(s=e),f===j&&(t=f),g===m&&(u=g),h===n&&(v=h),q=0;a>q;q++)for(r=0;b>r;r++)e!==i&&(s=d.integer(e,i)),f!==j&&(t=d.integer(f,j)),g!==m&&(u=d.integer(g,m)),h!==n&&(v=d.integer(h,n)),o.set(q,r,[s,t,u,v]);return o.surface}function d(){var a,b,c,d,e,f,g;if(3!==arguments.length)throw new Error("Improper arguments for relative surface");d=arguments[0],c=arguments[1],f=arguments[2],a=d.getSize()[0],b=d.getSize()[1],e=new k(d),g=new k([a,b]);for(var h,i=0;a>i;i++)for(var j=0;b>j;j++)h=f(i,j,e),h&&(c instanceof Function?g.set(i,j,c(i,j,e,h)):g.set(i,j,c));return g.surface}function e(){var a,b,c,d;if(4===arguments.length)d=arguments.length[0],a=arguments.length[0],b=arguments.length[1],c=arguments.length[2];else if(3===arguments.length)d=arguments.length[0],arguments[1]instanceof Array?(a=arguments[1][0],b=arguments[1][1],c=arguments[2]):(a=arguments[1],b=arguments[2]);else if(2===arguments.length){if(d=arguments[0],!(arguments[1]instanceof Array))throw new Error("Improper arguments for solid surface");a=arguments[0][0],b=arguments[0][1]}else{if(!(1===arguments.length&&arguments[0]instanceof Array))throw new Error("Improper arguments for solid surface");a=arguments[0][0],b=arguments[0][1]}return d?d.clear():d=new j(a,b),c&&d.fill(c),d}function f(){var a,b,c,d,f,g,j,k,m,n,o,p,q={lineColor:"#000",lineWidth:1,seed:0};if(6===arguments.length)p=arguments[0],a=arguments[1],b=arguments[2],c=arguments[3],d=arguments[4],n=arguments[5],o=arguments[6];else if(5===arguments.length)p=arguments[0],arguments[1]instanceof Array?(a=arguments[1][0],b=arguments[1][1],c=arguments[2],d=arguments[3],n=arguments[4],o=arguments[5]):(a=arguments[1],b=arguments[2],c=arguments[3],d=arguments[4],n=arguments[5]);else if(4===arguments.length)p=arguments[0],arguments[1]instanceof Array?(a=arguments[1][0],b=arguments[1][1],c=arguments[2],arguments[3]instanceof Object?(d=arguments[3].points,n=arguments[3].lineColor,o=arguments[3].lineWidth):(d=arguments[3],n=arguments[4])):(a=arguments[1],b=arguments[2],c=arguments[3],d=arguments[4]);else if(3===arguments.length)p=arguments[0],arguments[1]instanceof Array?(a=arguments[1][0],b=arguments[1][1],arguments[2]instanceof Object?(c=arguments[2].seed,d=arguments[2].points,n=arguments[2].lineColor,o=arguments[2].lineWidth):c=arguments[2]):(a=arguments[1],b=arguments[2]);else{if(!(2===arguments.length&&arguments[1]instanceof Array))throw new Error("Improper arguments for voronoi surface");p=arguments[0],a=arguments[1][0],b=arguments[1][1]}n=n||q.lineColor,o=o||q.lineWidth,c=c||q.seed,d=d||(a+b)/2,p=e(p,a,b),f=l.Alea(c),g=[],j=[0,0],k=[a,b];var r,s,t,u,v,w,x,y;for(r=0;d>r;r++)s=f.vector(j,k),t=s[0],u=s[1],v=t-a,w=t+a,x=u-b,y=u+b,g.push([v,x]),g.push([t,x]),g.push([w,x]),g.push([v,u]),g.push(s),g.push([w,u]),g.push([v,y]),g.push([t,y]),g.push([w,y]);m=h(g);var z,A,B,C,D,E;for(z in m.cells)for(A=m.cells[z],B=0;B<A.length;B++)C=0===B?A.length-1:B-1,D=A[B],E=A[C],-1!==D&&-1!==E&&(D=m.positions[D],E=m.positions[E],i.line(p,n,D,E,o));return p}var g=a("gamejs"),h=a("voronoi-diagram"),i=g.graphics,j=i.Surface,k=i.SurfaceArray,l=g.math.random;b.exports={noise:c,relative:d,solid:e,voronoi:f}},{gamejs:2,"voronoi-diagram":50}],52:[function(a,b){b.exports=["images/cursor_pointerFlat_shadow.png","images/grey_arrowDownGrey.png","images/grey_arrow_down.png","images/grey_arrow_up.png","images/menus/glass/center.png","images/menus/glass/corner-cut.png","images/menus/glass/corner-round.png","images/menus/glass/horizontal.png","images/menus/glass/vertical.png","images/menus/metal/center.png","images/menus/metal/corner.png","images/menus/metal/horizontal.png","images/menus/metal/red/half/split.png","images/menus/metal/red/top-left.png","images/menus/metal/red/top-right.png","images/menus/metal/red/top.png","images/menus/metal/vertical.png","images/red_x.png"]},{}],53:[function(a,b){b.exports=[{name:"noise",layer:a("./layers/noise")},{name:"shadow",layer:a("./layers/shadow")},{name:"solid",layer:a("./layers/solid")},{name:"voronoi",layer:a("./layers/voronoi")}]},{"./layers/noise":58,"./layers/shadow":59,"./layers/solid":60,"./layers/voronoi":61}],54:[function(a,b){b.exports=function(a,b,c){return function(d){var e=document.createElement("div");e.className="menu-controls";var f=function(){var e=document.createElement("input");return e.input="button",e.className="close",e.onclick=function(e){var f=a.indexOf(d);f>-1&&(a.splice(f,1),b.removeChild(b.childNodes[f]),c(e))},e}(),g=function(){var e=document.createElement("input");return e.input="button",e.className="up-arrow",e.onclick=function(e){var f=a.indexOf(d);if(f>0){var g=a[f-1];a[f-1]=a[f],a[f]=g,b.insertBefore(b.childNodes[f],b.childNodes[f-1]),c(e)}},e}(),h=function(){var e=document.createElement("input");return e.input="button",e.className="down-arrow",e.onclick=function(e){var f=a.indexOf(d);if(f>-1&&f<a.length-1){var g=a[f];a[f]=a[f+1],a[f+1]=g,b.insertBefore(b.childNodes[f+1],b.childNodes[f]),c(e)}},e}();return e.appendChild(f),e.appendChild(g),e.appendChild(h),e}}},{}],55:[function(a,b){b.exports=function(a,b,c,d,e,f){var g=document.createElement("div");g.innerHTML=c;var h=function(a){var c=document.createElement("input");return c.type="number",c.value=d,c.onchange=b,a.value=function(){return Number.parseInt(c.value)},(e||f||0===e||0===f)&&(a.handle=function(){var a=Number.parseInt(c.value);(e||0===e)&&e>a&&(c.value=e),(f||0===f)&&a>f&&(c.value=f)}),c}(a);return g.appendChild(h),g}},{}],56:[function(a,b){b.exports=function(a,b,c,d,e){var f=document.createElement("div");f.innerHTML=c,a.min={},a.max={};var g=function(a){var c=document.createElement("input");return c.type="number",c.value=d,c.onchange=b,a.value=function(){return Number.parseInt(c.value)},a.handle=function(){c.value<d&&(c.value=d)},c}(a.min),h=function(a){var c=document.createElement("input");return c.type="number",c.value=e,c.onchange=b,a.value=function(){return Number.parseInt(c.value)},a.handle=function(){c.value>e&&(c.value=e)},c}(a.max),i=function(){var a=document.createElement("span");return a.innerHTML="-",a}();return a.handle=function(){g.value>h.value&&(g.value=h.value)},f.appendChild(g),f.appendChild(i),f.appendChild(h),f}},{}],57:[function(a,b){b.exports=function(a,b,c,d){var e=document.createElement("div");e.innerHTML=c,d=d||"";var f=function(a){var c=document.createElement("input");return c.type="text",c.value=d,c.onchange=b,a.value=function(){return c.value},c}(a);return e.appendChild(f),e}},{}],58:[function(a,b){function c(a){var b=a.listeners,c=f.noise(a.surface,[64,64],b.seed.value(),[b.red.min.value(),b.green.min.value(),b.blue.min.value(),b.alpha.min.value()],[b.red.max.value(),b.green.max.value(),b.blue.max.value(),b.alpha.max.value()]);return a.surface=c,c}var d=a("./component/textInput"),e=a("./component/numberRangeInput"),f=a("../SurfaceFactory");b.exports=function(a,b){var f=document.createElement("div");f.className="control",f.innerHTML="Noise";var g={seed:{},red:{},green:{},blue:{},alpha:{}},h=d(g.seed,a,"Seed: ","1"),i=e(g.red,a,"Red: ",0,255),j=e(g.green,a,"Green: ",0,255),k=e(g.blue,a,"Blue: ",0,255),l=e(g.alpha,a,"Alpha: ",0,255),m={div:f,listeners:g,render:c};return f.appendChild(b(m)),f.appendChild(h),f.appendChild(i),f.appendChild(j),f.appendChild(k),f.appendChild(l),m}},{"../SurfaceFactory":51,"./component/numberRangeInput":56,"./component/textInput":57}],59:[function(a,b){function c(a,b){var c=(a.listeners,64),d=e.relative(b[2].render(b[2]),function(a,b,c,d){var e=c.get(a,b);return e[3]+=3*(12-d.dist),d.y<0&&(e[0]=160,e[1]=160,e[2]=160),e},function(a,b,d){var e=8;if(d.get(a,b)[3]>0)return!1;for(var f,g=1;e>g;g++)for(var h=-1;2>h;h++)if(0!==h){var i=b+g*h,j=a+0*g;if(i>c?i-=c:0>i&&(i+=c),f=d.get(j,i),f[3]>0)return{dist:g,y:h}}return!1});return a.surface=d,d}var d=a("./component/control"),e=a("../SurfaceFactory");b.exports=function(){var a=document.createElement("div");return a.className="control",a.innerHTML="Shadow",a.appendChild(d()),{div:a,listeners:{},render:c,surface:null}}},{"../SurfaceFactory":51,"./component/control":54}],60:[function(a,b){function c(a){var b=a.listeners,c=d.solid(a.surface,[64,64],b.color.value());return a.surface=c,c}var d=a("../SurfaceFactory"),e=a("./component/textInput");b.exports=function(a,b){var d=document.createElement("div");d.className="control",d.innerHTML="Solid";var f={color:{}},g=e(f.color,a,"Color: ","#FFF"),h={div:d,listeners:f,render:c,surface:null};return d.appendChild(b(h)),d.appendChild(g),h}},{"../SurfaceFactory":51,"./component/textInput":57}],61:[function(a,b){function c(a){var b=a.listeners,c=f.voronoi(a.surface,[64,64],{seed:b.seed.value(),lineWidth:b.width.value(),lineColor:b.color.value(),points:b.points.value()});return a.surface=c,c}var d=a("./component/textInput"),e=a("./component/numberInput"),f=a("../SurfaceFactory");b.exports=function(a,b){var f=document.createElement("div");f.className="control",f.innerHTML="Voronoi";var g={seed:{},width:{},color:{},points:{}},h=d(g.seed,a,"Seed: ","1"),i=e(g.width,a,"Width: ",1,1),j=d(g.color,a,"Color: ","#000"),k=e(g.points,a,"Cells: ",10,1),l={div:f,listeners:g,render:c,surface:null};return f.appendChild(b(l)),f.appendChild(h),f.appendChild(i),f.appendChild(j),f.appendChild(k),l}},{"../SurfaceFactory":51,"./component/numberInput":55,"./component/textInput":57}],62:[function(a,b){function c(a,b){function c(b){b.preventDefault(),f+=b.clientX-j[0],g+=b.clientY-j[1],j[0]=b.clientX,j[1]=b.clientY,a.style.left=f>0&&h>f?f+"px":h>f?"0px":h+"px",a.style.top=g>0&&i>g?g+"px":i>g?"0px":i+"px"}function d(a){a.preventDefault(),b.style.cursor="grab",document.onmousemove=void 0,document.onmouseup=void 0}function e(e){e.preventDefault(),f=a.style.left,g=a.style.top,h=a.parentElement.clientWidth-a.clientWidth,i=a.parentElement.clientHeight-a.clientHeight,f=f.length>2?Number.parseInt(f.slice(0,-2)):0,g=g.length>2?Number.parseInt(g.slice(0,-2)):0,b.style.cursor="grabbing",document.onmousemove=c,document.onmouseup=d,j[0]=e.clientX,j[1]=e.clientY}var f,g,h,i,j=[0,0];return e}function d(a,b,c){function d(b){b.preventDefault(),r&&(h+=b.clientX-g[0]),s&&(i+=b.clientY-g[1]),p&&(r?j-=b.clientX-g[0]:j+=b.clientX-g[0]),q&&(s?k-=b.clientY-g[1]:k+=b.clientY-g[1]),h>=0&&j>=l?a.style.left=h+"px":0>h&&(a.style.left="0px"),i>=0&&k>=m?a.style.top=i+"px":0>i&&(a.style.top="0px"),h>=0&&n>j?a.style.width=j+"px":j>n&&(a.style.width=n+"px"),i>=0&&o>k?a.style.height=k+"px":k>o&&(a.style.height=o+"px"),g[0]=b.clientX,g[1]=b.clientY}function e(a){a.preventDefault(),document.onmousemove=void 0,document.onmouseup=void 0}function f(b){b.preventDefault(),h=a.style.left,i=a.style.top,j=a.style.width,k=a.style.height,l=a.style.min-j,m=a.style.min-k,n=a.style.max-j,o=a.style.max-k,h=h.length>2?Number.parseInt(h.slice(0,-2)):0,i=i.length>2?Number.parseInt(i.slice(0,-2)):0,j=j.length>2?Number.parseInt(j.slice(0,-2)):0,k=k.length>2?Number.parseInt(k.slice(0,-2)):0,l=l.length>2?Number.parseInt(l.slice(0,-2)):96,m=m.length>2?Number.parseInt(m.slice(0,-2)):96,n=n.length>2?Number.parseInt(n.slice(0,-2)):a.parentElement.clientWidth,o=o.length>2?Number.parseInt(o.slice(0,-2)):a.parentElement.clientHeight,document.onmousemove=d,document.onmouseup=e,g[0]=b.clientX,g[1]=b.clientY}var g,h,i,j,k,l,m,n,o;g=[0,0];var p=void 0!==c.width,q=void 0!==c.height,r=c.width,s=c.height;return f}b.exports=function(){var a,b=0,e=0,f=document.getElementById("menu-template").cloneNode(!0);if(2===arguments.length)arguments[0]instanceof Array&&2===arguments[0].length?(b=arguments[0][0],e=arguments[0][1],a=arguments[1]):(b=arguments[0],e=arguments[1]);else{if(1!==arguments.length)throw new Error("improper arguments for menu");arguments[0]instanceof Array&&arguments[0].length>1?(b=arguments[0][0],e=arguments[0][1]):a=arguments[0]}return b&&e&&(f.style.width=b+"px",f.style.height=e+"px"),a&&f.classList.add(a),f.children[0].onmousedown=d(f,f.children[0],{width:!0,height:!0}),f.children[1].onmousedown=c(f,f.children[1]),f.children[2].onmousedown=d(f,f.children[2],{width:!1,height:!0}),f.children[3].onmousedown=d(f,f.children[3],{width:!0}),f.children[5].onmousedown=d(f,f.children[5],{width:!1}),f.children[6].onmousedown=d(f,f.children[6],{width:!0,height:!1}),f.children[7].onmousedown=d(f,f.children[7],{height:!1}),f.children[8].onmousedown=d(f,f.children[8],{width:!1,height:!1}),f}},{}],63:[function(a,b){b.exports=[]},{}]},{},[51,52,53,54,55,56,57,58,59,60,61,62,63,1]);