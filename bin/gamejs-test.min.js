/*! gamejs-test 26-02-2015 */
function noise(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n={min:0,max:255,seed:0};if(5===arguments.length){if(!(arguments[3]instanceof Array&&arguments[4]instanceof Array&&arguments[3].length>=3&&arguments[4].length>=3))throw new Error("Improper arguments for noise surface");a=arguments[0],b=arguments[1],c=arguments[2],e=arguments[3][0],f=arguments[3][1],g=arguments[3][2],i=arguments[4][0],j=arguments[4][1],k=arguments[4][2],arguments[3].length>3&&(h=arguments[3][3]),arguments[4].length>3&&(l=arguments[4][3])}else if(4===arguments.length){if(arguments[0]instanceof Array?(a=arguments[0][0],b=arguments[0][1],c=arguments[1]):(a=arguments[0],b=arguments[1]),!(arguments[2]instanceof Array&&arguments[3]instanceof Array&&arguments[2].length>=3&&arguments[3].length>=3))throw new Error("Improper arguments for noise surface");e=arguments[2][0],f=arguments[2][1],g=arguments[2][2],i=arguments[3][0],j=arguments[3][1],k=arguments[3][2],arguments[2].length>3&&(h=arguments[2][3]),arguments[3].length>3&&(l=arguments[3][3])}else{if(3!==arguments.length)throw new Error("Improper arguments for noise surface");if(arguments[0]instanceof Array&&(a=arguments[0][0],b=arguments[0][1]),!(arguments[1]instanceof Array&&arguments[2]instanceof Array&&arguments[1].length>=3&&arguments[2].length>=3))throw new Error("Improper arguments for noise surface");e=arguments[1][0],f=arguments[1][1],g=arguments[1][2],i=arguments[2][0],j=arguments[2][1],k=arguments[2][2],arguments[1].length>3&&(h=arguments[1][3]),arguments[2].length>3&&(l=arguments[2][3])}e=e||n.min,f=f||n.min,g=g||n.min,h=h||n.min,i=i||0===i?i:n.max,j=j||0===j?j:n.max,k=k||0===k?k:n.max,l=l||0===l?l:n.max,c=c||n.seed,d=random.Alea(c),m=new SurfaceArray([a,b]);var o,p,q,r,s,t;for(e===i&&(q=e),f===j&&(r=f),g===k&&(s=g),h===l&&(t=h),o=0;a>o;o++)for(p=0;b>p;p++)e!==i&&(q=d.integer(e,i)),f!==j&&(r=d.integer(f,j)),g!==k&&(s=d.integer(g,k)),h!==l&&(t=d.integer(h,l)),m.set(o,p,[q,r,s,t]);return m.surface}function relative(){var a,b,c,d,e,f,g;if(3!==arguments.length)throw new Error("Improper arguments for relative surface");d=arguments[0],c=arguments[1],f=arguments[2],a=d.getSize()[0],b=d.getSize()[1],e=new SurfaceArray(d),g=new SurfaceArray([a,b]);for(var h,i=0;a>i;i++)for(var j=0;b>j;j++)h=f(i,j,e),h&&(c instanceof Function?g.set(i,j,c(i,j,e,h)):g.set(i,j,c));return g.surface}function solid(){var a,b,c,d;if(3===arguments.length)a=arguments.length[0],b=arguments.length[1],c=arguments.length[2];else if(2===arguments.length)arguments[0]instanceof Array?(a=arguments[0][0],b=arguments[0][1],c=arguments[1]):(a=arguments[0],b=arguments[1]);else{if(!(1===arguments.length&&arguments[0]instanceof Array))throw new Error("Improper arguments for solid surface");a=arguments[0][0],b=arguments[0][1]}return d=new Surface(a,b),c&&d.fill(c),d}function voronoi(){var a,b,c,d,e,f,h,i,j,k,l,m,n={lineColor:"#000",lineWidth:1,seed:0};if(5===arguments.length)a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3],k=arguments[4],l=arguments[5];else if(4===arguments.length)arguments[0]instanceof Array?(a=arguments[0][0],b=arguments[0][1],c=arguments[1],d=arguments[2],k=arguments[3],l=arguments[4]):(a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3],k=arguments[4]);else if(3===arguments.length)arguments[0]instanceof Array?(a=arguments[0][0],b=arguments[0][1],c=arguments[1],arguments[2]instanceof Object?(d=arguments[2].points,k=arguments[2].lineColor,l=arguments[2].lineWidth):(d=arguments[2],k=arguments[3])):(a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3]);else if(2===arguments.length)arguments[0]instanceof Array?(a=arguments[0][0],b=arguments[0][1],arguments[1]instanceof Object?(c=arguments[1].seed,d=arguments[1].points,k=arguments[1].lineColor,l=arguments[1].lineWidth):c=arguments[1]):(a=arguments[0],b=arguments[1]);else{if(!(1===arguments.length&&arguments[0]instanceof Array))throw new Error("Improper arguments for voronoi surface");a=arguments[0][0],b=arguments[0][1]}k=k||n.lineColor,l=l||n.lineWidth,c=c||n.seed,d=d||(a+b)/2,m=solid(a,b),e=random.Alea(c),f=[],h=[0,0],i=[a,b];var o,p,q,r,s,t,u,v;for(o=0;d>o;o++)p=e.vector(h,i),q=p[0],r=p[1],s=q-a,t=q+a,u=r-b,v=r+b,f.push([s,u]),f.push([q,u]),f.push([t,u]),f.push([s,r]),f.push(p),f.push([t,r]),f.push([s,v]),f.push([q,v]),f.push([t,v]);j=voronoiGenerator(f);var w,x,y,z,A,B;for(w in j.cells)for(x=j.cells[w],y=0;y<x.length;y++)z=0===y?x.length-1:y-1,A=x[y],B=x[z],-1!==A&&-1!==B&&(A=j.positions[A],B=j.positions[B],g.line(m,k,A,B,l));return m}function move(a,b){function c(b){b.preventDefault(),f+=b.clientX-j[0],g+=b.clientY-j[1],j[0]=b.clientX,j[1]=b.clientY,a.style.left=f>0&&h>f?f+"px":h>f?"0px":h+"px",a.style.top=g>0&&i>g?g+"px":i>g?"0px":i+"px"}function d(a){a.preventDefault(),b.style.cursor="grab",document.onmousemove=void 0,document.onmouseup=void 0}function e(e){e.preventDefault(),f=a.style.left,g=a.style.top,h=a.parentElement.clientWidth-a.clientWidth,i=a.parentElement.clientHeight-a.clientHeight,f=f.length>2?Number.parseInt(f.slice(0,-2)):0,g=g.length>2?Number.parseInt(g.slice(0,-2)):0,b.style.cursor="grabbing",document.onmousemove=c,document.onmouseup=d,j[0]=e.clientX,j[1]=e.clientY}var f,g,h,i,j=[0,0];return e}function resize(a,b,c){function d(b){b.preventDefault(),r&&(h+=b.clientX-g[0]),s&&(i+=b.clientY-g[1]),p&&(r?j-=b.clientX-g[0]:j+=b.clientX-g[0]),q&&(s?k-=b.clientY-g[1]:k+=b.clientY-g[1]),h>=0&&j>=l?a.style.left=h+"px":0>h&&(a.style.left="0px"),i>=0&&k>=m?a.style.top=i+"px":0>i&&(a.style.top="0px"),h>=0&&n>j?a.style.width=j+"px":j>n&&(a.style.width=n+"px"),i>=0&&o>k?a.style.height=k+"px":k>o&&(a.style.height=o+"px"),g[0]=b.clientX,g[1]=b.clientY}function e(a){a.preventDefault(),document.onmousemove=void 0,document.onmouseup=void 0}function f(b){b.preventDefault(),h=a.style.left,i=a.style.top,j=a.style.width,k=a.style.height,l=a.style.min-j,m=a.style.min-k,n=a.style.max-j,o=a.style.max-k,h=h.length>2?Number.parseInt(h.slice(0,-2)):0,i=i.length>2?Number.parseInt(i.slice(0,-2)):0,j=j.length>2?Number.parseInt(j.slice(0,-2)):0,k=k.length>2?Number.parseInt(k.slice(0,-2)):0,l=l.length>2?Number.parseInt(l.slice(0,-2)):96,m=m.length>2?Number.parseInt(m.slice(0,-2)):96,n=n.length>2?Number.parseInt(n.slice(0,-2)):a.parentElement.clientWidth,o=o.length>2?Number.parseInt(o.slice(0,-2)):a.parentElement.clientHeight,document.onmousemove=d,document.onmouseup=e,g[0]=b.clientX,g[1]=b.clientY}var g,h,i,j,k,l,m,n,o;g=[0,0];var p=void 0!==c.width,q=void 0!==c.height,r=c.width,s=c.height;return f}function buildMenu(){var a=menuBuilder([700,522],"metal"),b=a.children[4],c=function(){var a=document.createElement("div");a.className="leftdiv";var b=function(){var a=document.createElement("canvas");return a.width=256,a.height=256,a.className="canvas",menuCanvasContext=a.getContext("2d"),a}(),c=function(){var a=document.createElement("div");a.className="controls",a.style.width="100%",a.style.display="block",a.style.padding="5px";var b=function(){var a=document.createElement("div"),b=function(){var a=document.createElement("div");return a.innerHTML="Add Layer",a}(),c=function(){function a(a,b){var c=document.createElement("option");return c.innerHTML=a,c.value=b,c}var b=document.createElement("select");return b.appendChild(a("solid",0)),b.appendChild(a("noise",1)),b.appendChild(a("voronoi",2)),b.appendChild(a("shadow",3)),b}(),d=function(){var a=document.createElement("input");return a.type="button",a.value="+",a.style["float"]="right",a}();return a.appendChild(b),a.appendChild(c),a.appendChild(d),a}();return a.appendChild(b),a}();return a.appendChild(b),a.appendChild(c),a}(),d=function(a){function b(b){b.preventDefault(),surface=renderSurface(surface,a)}var c=document.createElement("div");c.className="controls",a.layer={},a.background={},a.noise={},a.voronoi={},a.shadow={};var d=function(){var a=document.createElement("div");a.className="menu-controls";var b=function(){var a=document.createElement("input");return a.input="button",a.className="close",a}(),c=function(){var a=document.createElement("input");return a.input="button",a.className="up-arrow",a}(),d=function(){var a=document.createElement("input");return a.input="button",a.className="down-arrow",a}();return a.appendChild(b),a.appendChild(c),a.appendChild(d),a},e=backgroundLayer.dataGUI(a.background),f=function(a){var c=document.createElement("div");c.className="control",c.innerHTML="Noise",a.seed={},a.red={},a.green={},a.blue={},a.alpha={};var e=function(a){var c=document.createElement("div");c.innerHTML="Seed: ";var d=function(a){var c=document.createElement("input");return c.type="text",c.value="1",c.onchange=b,a.value=function(){return c.value},c}(a);return c.appendChild(d),c}(a.seed),f=function(a){var c=document.createElement("div");c.innerHTML="Red: ",a.min={},a.max={};var d=function(a){var c=document.createElement("input");return c.type="number",c.value=0,c.onchange=b,a.value=function(){return Number.parseInt(c.value)},a.handle=function(){console.log("asd"),c.value<0&&(c.value=0)},c}(a.min),e=function(a){var c=document.createElement("input");return c.type="number",c.value=32,c.onchange=b,a.value=function(){return Number.parseInt(c.value)},a.handle=function(){c.value>255&&(c.value=32)},c}(a.max),f=function(){var a=document.createElement("span");return a.innerHTML="-",a}();return a.handle=function(){d.value>e.value&&(d.value=e.value)},c.appendChild(d),c.appendChild(f),c.appendChild(e),c}(a.red),g=function(a){var c=document.createElement("div");c.innerHTML="Green: ",a.min={},a.max={};var d=function(a){var c=document.createElement("input");return c.type="number",c.value=0,c.onchange=b,a.value=function(){return Number.parseInt(c.value)},a.handle=function(){c.value<0&&(c.value=0)},c}(a.min),e=function(a){var c=document.createElement("input");return c.type="number",c.value=32,c.onchange=b,a.value=function(){return Number.parseInt(c.value)},a.handle=function(){c.value>255&&(c.value=255)},c}(a.max),f=function(){var a=document.createElement("span");return a.innerHTML="-",a}();return a.handle=function(){d.value>e.value&&(d.value=e.value)},c.appendChild(d),c.appendChild(f),c.appendChild(e),c}(a.green),h=function(a){var c=document.createElement("div");c.innerHTML="Blue: ",a.min={},a.max={};var d=function(a){var c=document.createElement("input");return c.type="number",c.value=0,c.onchange=b,a.value=function(){return Number.parseInt(c.value)},a.handle=function(){c.value<0&&(c.value=0)},c}(a.min),e=function(a){var c=document.createElement("input");return c.type="number",c.value=32,c.onchange=b,a.value=function(){return Number.parseInt(c.value)},a.handle=function(){c.value>255&&(c.value=255)},c}(a.max),f=function(){var a=document.createElement("span");return a.innerHTML="-",a}();return a.handle=function(){d.value>e.value&&(d.value=e.value)},c.appendChild(d),c.appendChild(f),c.appendChild(e),c}(a.blue),i=function(a){var c=document.createElement("div");c.innerHTML="Alpha: ",a.min={},a.max={};var d=function(a){var c=document.createElement("input");return c.type="number",c.value=0,c.onchange=b,a.value=function(){return Number.parseInt(c.value)},a.handle=function(){c.value<0&&(c.value=0)},c}(a.min),e=function(a){var c=document.createElement("input");return c.type="number",c.value=120,c.onchange=b,a.value=function(){return Number.parseInt(c.value)},a.handle=function(){c.value>255&&(c.value=255)},c}(a.max),f=function(){var a=document.createElement("span");return a.innerHTML="-",a}();return a.handle=function(){d.value>e.value&&(d.value=e.value)},c.appendChild(d),c.appendChild(f),c.appendChild(e),c}(a.alpha);return c.appendChild(d()),c.appendChild(e),c.appendChild(f),c.appendChild(g),c.appendChild(h),c.appendChild(i),c}(a.noise),g=function(a){var c=document.createElement("div");c.className="control",c.innerHTML="Voronoi",a.seed={},a.width={},a.color={},a.points={};var e=function(a){var c=document.createElement("div");c.innerHTML="Seed: ";var d=function(a){var c=document.createElement("input");return c.type="text",c.value="1",c.onchange=b,a.value=function(){return c.value},c}(a);return c.appendChild(d),c}(a.seed),f=function(a){var c=document.createElement("div");c.innerHTML="Width: ";var d=function(a){var c=document.createElement("input");return c.type="number",c.value="1",c.onchange=b,a.value=function(){return c.value},c}(a);return c.appendChild(d),c}(a.width),g=function(a){var c=document.createElement("div");c.innerHTML="Color: ";var d=function(a){var c=document.createElement("input");return c.type="text",c.value="#111",c.onchange=b,a.value=function(){return c.value},c}(a);return c.appendChild(d),c}(a.color),h=function(a){var c=document.createElement("div");c.innerHTML="Cells: ";var d=function(a){var c=document.createElement("input");return c.type="number",c.value=10,c.onchange=b,a.value=function(){return Number.parseInt(c.value)},a.handle=function(){c.value<1&&(c.value=1)},c}(a);return c.appendChild(d),c}(a.points);return c.appendChild(d()),c.appendChild(e),c.appendChild(f),c.appendChild(g),c.appendChild(h),c}(a.voronoi),h=function(){var a=document.createElement("div");return a.className="control",a.innerHTML="Shadow",a.appendChild(d()),a}(a.shadow);return c.appendChild(e),c.appendChild(f),c.appendChild(g),c.appendChild(h),c}(listeners);return b.appendChild(c),b.appendChild(d),a}function renderSurface(a,b){var c=[],d=64;if(a=SurfaceFactory.solid([d,d]),!b)return a;var e=function(a){return SurfaceFactory.solid([d,d],a.color.value())}(b.background),f=function(a){return SurfaceFactory.noise([d,d],a.seed.value(),[a.red.min.value(),a.green.min.value(),a.blue.min.value(),a.alpha.min.value()],[a.red.max.value(),a.green.max.value(),a.blue.max.value(),a.alpha.max.value()])}(b.noise),g=function(a){return SurfaceFactory.voronoi([d,d],{seed:a.seed.value(),lineWidth:a.width.value(),lineColor:a.color.value(),points:a.points.value()})}(b.voronoi),h=SurfaceFactory.relative(g,function(a,b,c,d){var e=c.get(a,b);return e[3]+=3*(12-d.dist),d.y<0&&(e[0]=160,e[1]=160,e[2]=160),e},function(a,b,c){var e=8;if(c.get(a,b)[3]>0)return!1;for(var f,g=1;e>g;g++)for(var h=-1;2>h;h++)if(0!==h){var i=b+g*h,j=a+0*g;if(i>d?i-=d:0>i&&(i+=d),f=c.get(j,i),f[3]>0)return{dist:g,y:h}}return!1});c.push(e),c.push(f),c.push(g),c.push(h);for(var i in c)a.blit(c[i]);return a}function render(a){menuCanvasContext.putImageData(a.scale([256,256]).getImageData(),0,0);var b=gamejs.display.getSurface();b.clear();for(var c=b.getSize()[0],d=b.getSize()[1],e=a.getSize(),f=0;f*e[0]<c;f++)for(var g=0;g*e[1]<d;g++)b.blit(a,[f*e[0],g*e[1]])}var gamejs=require("gamejs"),voronoiGenerator=require("voronoi-diagram"),g=gamejs.graphics,Surface=g.Surface,SurfaceArray=g.SurfaceArray,random=gamejs.math.random;module.exports={noise:noise,relative:relative,solid:solid,voronoi:voronoi},module.exports=["images/cursor_pointerFlat_shadow.png","images/grey_arrowDownGrey.png","images/grey_arrow_down.png","images/grey_arrow_up.png","images/menus/glass/center.png","images/menus/glass/corner-cut.png","images/menus/glass/corner-round.png","images/menus/glass/horizontal.png","images/menus/glass/vertical.png","images/menus/metal/center.png","images/menus/metal/corner.png","images/menus/metal/horizontal.png","images/menus/metal/red/half/split.png","images/menus/metal/red/top-left.png","images/menus/metal/red/top-right.png","images/menus/metal/red/top.png","images/menus/metal/vertical.png","images/red_x.png"],module.exports=function(){var a,b=0,c=0,d=document.getElementById("menu-template").cloneNode(!0);if(2===arguments.length)arguments[0]instanceof Array&&2===arguments[0].length?(b=arguments[0][0],c=arguments[0][1],a=arguments[1]):(b=arguments[0],c=arguments[1]);else{if(1!==arguments.length)throw new Error("improper arguments for menu");arguments[0]instanceof Array&&arguments[0].length>1?(b=arguments[0][0],c=arguments[0][1]):a=arguments[0]}return b&&c&&(d.style.width=b+"px",d.style.height=c+"px"),a&&d.classList.add(a),d.children[0].onmousedown=resize(d,d.children[0],{width:!0,height:!0}),d.children[1].onmousedown=move(d,d.children[1]),d.children[2].onmousedown=resize(d,d.children[2],{width:!1,height:!0}),d.children[3].onmousedown=resize(d,d.children[3],{width:!0}),d.children[5].onmousedown=resize(d,d.children[5],{width:!1}),d.children[6].onmousedown=resize(d,d.children[6],{width:!0,height:!1}),d.children[7].onmousedown=resize(d,d.children[7],{height:!1}),d.children[8].onmousedown=resize(d,d.children[8],{width:!1,height:!1}),d},module.exports=[];var gamejs=require("gamejs"),SurfaceFactory=require("./src/SurfaceFactory"),menuBuilder=require("./src/menuBuilder"),backgroundLayer=require("./src/layers/background");gamejs.preload(require("./src/images"));var BORDER_WIDTH=1,wrapper,menu,menuCanvasContext,surface,draw=!0,fetch=!0,listeners={};gamejs.ready(function(){var a=document.getElementById("gjs-canvas-wrapper");a.style.display="block";var b=window.innerWidth-2*BORDER_WIDTH,c=window.innerHeight-2*BORDER_WIDTH;gamejs.display.setMode([b,c])}),gamejs.onTick(function(){menu||(menu=buildMenu()),surface||(surface=renderSurface(surface,listeners)),wrapper||(wrapper=document.getElementById("gjs-canvas-wrapper"),wrapper.appendChild(menu)),render(surface)});